<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 3 Monte Carlo Simulation (20 pnts) | Quantitative Environmental Methods: LRES 546</title>
  <meta name="description" content="Chapter 3 Monte Carlo Simulation (20 pnts) | Quantitative Environmental Methods: LRES 546" />
  <meta name="generator" content="bookdown 0.41 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 3 Monte Carlo Simulation (20 pnts) | Quantitative Environmental Methods: LRES 546" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 3 Monte Carlo Simulation (20 pnts) | Quantitative Environmental Methods: LRES 546" />
  
  
  

<meta name="author" content="Tim Covino &amp; Lauren Kremer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="part-2-tabular-models-and-time-series.html"/>
<link rel="next" href="classifying-model-structure---lecture-only-0-pts.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">lres_546</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Part 1: Foundations of Environmental Modeling</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#introduction"><i class="fa fa-check"></i><b>1.1</b> Introduction</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#course-overview-and-objectives"><i class="fa fa-check"></i><b>1.2</b> Course overview and objectives</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i><b>1.3</b> Course Description</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.4</b> Structure</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#philosophical-approach-and-resources"><i class="fa fa-check"></i><b>1.5</b> Philosophical approach and resources</a></li>
<li class="chapter" data-level="1.6" data-path="index.html"><a href="index.html#tentative-schedule-subject-to-change"><i class="fa fa-check"></i><b>1.6</b> Tentative schedule, subject to change</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html"><i class="fa fa-check"></i><b>2</b> Part 2: Tabular Models and Time-Series</a>
<ul>
<li class="chapter" data-level="2.1" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#hydrograph-separation"><i class="fa fa-check"></i><b>2.1</b> Hydrograph separation</a>
<ul>
<li class="chapter" data-level="2.1.1" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#learning-module"><i class="fa fa-check"></i><b>2.1.1</b> Learning Module</a></li>
<li class="chapter" data-level="2.1.2" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#lecture"><i class="fa fa-check"></i><b>2.1.2</b> Lecture</a></li>
<li class="chapter" data-level="2.1.3" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#assessment-20-pts"><i class="fa fa-check"></i><b>2.1.3</b> Assessment (20 pts)</a></li>
<li class="chapter" data-level="2.1.4" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#hydrograph-separation-lab-module-20-pts"><i class="fa fa-check"></i><b>2.1.4</b> Hydrograph separation: lab module (20 pts)</a></li>
</ul></li>
<li class="chapter" data-level="2.2" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#return-intervals"><i class="fa fa-check"></i><b>2.2</b> Return Intervals</a>
<ul>
<li class="chapter" data-level="2.2.1" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#learning-module-1"><i class="fa fa-check"></i><b>2.2.1</b> Learning Module</a></li>
<li class="chapter" data-level="2.2.2" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#labwork-20-pts"><i class="fa fa-check"></i><b>2.2.2</b> Labwork (20 pts)</a></li>
</ul></li>
<li class="chapter" data-level="2.3" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#rational-method-and-nrcs-curve-number-20-pts"><i class="fa fa-check"></i><b>2.3</b> Rational method and NRCS curve number (20 pts)</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#learning-module-2"><i class="fa fa-check"></i><b>2.3.1</b> Learning Module</a></li>
<li class="chapter" data-level="2.3.2" data-path="part-2-tabular-models-and-time-series.html"><a href="part-2-tabular-models-and-time-series.html#labwork-20-pts-1"><i class="fa fa-check"></i><b>2.3.2</b> Labwork (20 pts)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html"><i class="fa fa-check"></i><b>3</b> Monte Carlo Simulation (20 pnts)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#background"><i class="fa fa-check"></i><b>3.1</b> Background:</a>
<ul>
<li class="chapter" data-level="3.1.1" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#reading"><i class="fa fa-check"></i><b>3.1.1</b> Reading</a></li>
</ul></li>
<li class="chapter" data-level="3.2" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#how-does-this-apply-to-hydrological-modeling"><i class="fa fa-check"></i><b>3.2</b> How does this apply to hydrological modeling?</a>
<ul>
<li class="chapter" data-level="3.2.1" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#example"><i class="fa fa-check"></i><b>3.2.1</b> Example</a></li>
<li class="chapter" data-level="3.2.2" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#reading-1"><i class="fa fa-check"></i><b>3.2.2</b> Reading</a></li>
</ul></li>
<li class="chapter" data-level="3.3" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#how-do-we-generate-a-simulation-with-code"><i class="fa fa-check"></i><b>3.3</b> How do we generate a simulation with code?</a></li>
<li class="chapter" data-level="3.4" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#codework"><i class="fa fa-check"></i><b>3.4</b> Codework</a>
<ul>
<li class="chapter" data-level="3.4.1" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#download-the-repo-for-this-lab-here"><i class="fa fa-check"></i><b>3.4.1</b> Download the repo for this lab HERE</a></li>
<li class="chapter" data-level="3.4.2" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#setup"><i class="fa fa-check"></i><b>3.4.2</b> Setup</a></li>
<li class="chapter" data-level="3.4.3" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#parameter-initialization"><i class="fa fa-check"></i><b>3.4.3</b> Parameter initialization</a></li>
<li class="chapter" data-level="3.4.4" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#mc-model-run"><i class="fa fa-check"></i><b>3.4.4</b> MC Model run</a></li>
<li class="chapter" data-level="3.4.5" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#sensitivity-analysis"><i class="fa fa-check"></i><b>3.4.5</b> Sensitivity analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="4" data-path="classifying-model-structure---lecture-only-0-pts.html"><a href="classifying-model-structure---lecture-only-0-pts.html"><i class="fa fa-check"></i><b>4</b> Classifying model structure - Lecture only (0 pts)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="classifying-model-structure---lecture-only-0-pts.html"><a href="classifying-model-structure---lecture-only-0-pts.html#spatial-complexity"><i class="fa fa-check"></i><b>4.1</b> Spatial Complexity</a></li>
<li class="chapter" data-level="4.2" data-path="classifying-model-structure---lecture-only-0-pts.html"><a href="classifying-model-structure---lecture-only-0-pts.html#modeling-approaches"><i class="fa fa-check"></i><b>4.2</b> Modeling Approaches</a></li>
</ul></li>
<li class="chapter" data-level="5" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><i class="fa fa-check"></i><b>5</b> Snowmelt Models for runoff timing - Lecture &amp; Lab (20 pts)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#module-repo"><i class="fa fa-check"></i><b>5.1</b> Module repo</a></li>
<li class="chapter" data-level="5.2" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#background-1"><i class="fa fa-check"></i><b>5.2</b> Background:</a></li>
<li class="chapter" data-level="5.3" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#model-approaches"><i class="fa fa-check"></i><b>5.3</b> Model Approaches</a></li>
<li class="chapter" data-level="5.4" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#spatial-complexity-1"><i class="fa fa-check"></i><b>5.4</b> Spatial complexity</a></li>
<li class="chapter" data-level="5.5" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#model-choices-my-snow-is-different-from-your-snow"><i class="fa fa-check"></i><b>5.5</b> Model choices: My snow is different from your snow</a></li>
<li class="chapter" data-level="5.6" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#codework-1"><i class="fa fa-check"></i><b>5.6</b> Codework</a>
<ul>
<li class="chapter" data-level="5.6.1" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#download-the-repo-for-this-lab-here-1"><i class="fa fa-check"></i><b>5.6.1</b> Download the repo for this lab HERE</a></li>
<li class="chapter" data-level="5.6.2" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#import-data"><i class="fa fa-check"></i><b>5.6.2</b> Import data:</a></li>
<li class="chapter" data-level="5.6.3" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#calculate-liquid-input"><i class="fa fa-check"></i><b>5.6.3</b> Calculate liquid input</a></li>
</ul></li>
<li class="chapter" data-level="5.7" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#modeling-swe"><i class="fa fa-check"></i><b>5.7</b> Modeling SWE</a></li>
</ul></li>
<li class="chapter" data-level="6" data-path="evapotranspiration.html"><a href="evapotranspiration.html"><i class="fa fa-check"></i><b>6</b> Evapotranspiration</a>
<ul>
<li class="chapter" data-level="6.1" data-path="evapotranspiration.html"><a href="evapotranspiration.html#the-repo-can-be-found-here"><i class="fa fa-check"></i><b>6.1</b> The repo can be found here</a></li>
<li class="chapter" data-level="6.2" data-path="evapotranspiration.html"><a href="evapotranspiration.html#background-2"><i class="fa fa-check"></i><b>6.2</b> Background</a>
<ul>
<li class="chapter" data-level="6.2.1" data-path="evapotranspiration.html"><a href="evapotranspiration.html#transpiration"><i class="fa fa-check"></i><b>6.2.1</b> Transpiration</a></li>
<li class="chapter" data-level="6.2.2" data-path="evapotranspiration.html"><a href="evapotranspiration.html#measurements"><i class="fa fa-check"></i><b>6.2.2</b> Measurements</a></li>
</ul></li>
<li class="chapter" data-level="6.3" data-path="evapotranspiration.html"><a href="evapotranspiration.html#codework-2"><i class="fa fa-check"></i><b>6.3</b> Codework:</a>
<ul>
<li class="chapter" data-level="6.3.1" data-path="evapotranspiration.html"><a href="evapotranspiration.html#the-evapotranspiration-package"><i class="fa fa-check"></i><b>6.3.1</b> The Evapotranspiration package</a></li>
<li class="chapter" data-level="6.3.2" data-path="evapotranspiration.html"><a href="evapotranspiration.html#the-priestly-taylor-method-actual-evapotranspiration"><i class="fa fa-check"></i><b>6.3.2</b> The Priestly Taylor method (actual evapotranspiration)</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html"><i class="fa fa-check"></i><b>7</b> Learning Module 10 - Gridded and tabular data retrieval</a>
<ul>
<li class="chapter" data-level="7.1" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#objectives"><i class="fa fa-check"></i><b>7.1</b> Objectives</a></li>
<li class="chapter" data-level="7.2" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#background-3"><i class="fa fa-check"></i><b>7.2</b> Background</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#a-refresher-in-gis-concepts"><i class="fa fa-check"></i><b>7.2.1</b> A refresher in GIS concepts:</a></li>
<li class="chapter" data-level="7.2.2" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#a-refresher-in-remote-sensing"><i class="fa fa-check"></i><b>7.2.2</b> A refresher in remote sensing:</a></li>
<li class="chapter" data-level="7.2.3" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#ethical-conduct"><i class="fa fa-check"></i><b>7.2.3</b> Ethical conduct</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#codework-3"><i class="fa fa-check"></i><b>7.3</b> Codework</a>
<ul>
<li class="chapter" data-level="7.3.1" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#setup-1"><i class="fa fa-check"></i><b>7.3.1</b> Setup:<br></a></li>
<li class="chapter" data-level="7.3.2" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#selecting-a-watershed"><i class="fa fa-check"></i><b>7.3.2</b> Selecting a watershed:</a></li>
<li class="chapter" data-level="7.3.3" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#flow-data-retrieval"><i class="fa fa-check"></i><b>7.3.3</b> Flow data retrieval:</a></li>
<li class="chapter" data-level="7.3.4" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#watershed-boundary-vector-data"><i class="fa fa-check"></i><b>7.3.4</b> Watershed boundary vector data:</a></li>
<li class="chapter" data-level="7.3.5" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#digital-elevation-models-dem"><i class="fa fa-check"></i><b>7.3.5</b> Digital Elevation Models (DEM)</a></li>
<li class="chapter" data-level="7.3.6" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#other-remotely-sensed-data"><i class="fa fa-check"></i><b>7.3.6</b> Other remotely sensed data:</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="dem-processing.html"><a href="dem-processing.html"><i class="fa fa-check"></i><b>8</b> DEM processing</a>
<ul>
<li class="chapter" data-level="8.1" data-path="dem-processing.html"><a href="dem-processing.html#the-link-to-the-repo-is-here"><i class="fa fa-check"></i><b>8.1</b> THE LINK TO THE REPO IS HERE</a></li>
<li class="chapter" data-level="8.2" data-path="dem-processing.html"><a href="dem-processing.html#objective"><i class="fa fa-check"></i><b>8.2</b> Objective:</a></li>
<li class="chapter" data-level="8.3" data-path="dem-processing.html"><a href="dem-processing.html#background-4"><i class="fa fa-check"></i><b>8.3</b> Background:</a></li>
<li class="chapter" data-level="8.4" data-path="dem-processing.html"><a href="dem-processing.html#codework-4"><i class="fa fa-check"></i><b>8.4</b> Codework</a>
<ul>
<li class="chapter" data-level="8.4.1" data-path="dem-processing.html"><a href="dem-processing.html#installing-libraries"><i class="fa fa-check"></i><b>8.4.1</b> Installing libraries</a></li>
<li class="chapter" data-level="8.4.2" data-path="dem-processing.html"><a href="dem-processing.html#generate-functions"><i class="fa fa-check"></i><b>8.4.2</b> Generate functions</a></li>
<li class="chapter" data-level="8.4.3" data-path="dem-processing.html"><a href="dem-processing.html#establish-new-directoriesfolders"><i class="fa fa-check"></i><b>8.4.3</b> Establish new directories(folders)</a></li>
<li class="chapter" data-level="8.4.4" data-path="dem-processing.html"><a href="dem-processing.html#resample-dems"><i class="fa fa-check"></i><b>8.4.4</b> Resample DEMs</a></li>
<li class="chapter" data-level="8.4.5" data-path="dem-processing.html"><a href="dem-processing.html#filling-and-breaching"><i class="fa fa-check"></i><b>8.4.5</b> Filling and breaching</a></li>
<li class="chapter" data-level="8.4.6" data-path="dem-processing.html"><a href="dem-processing.html#flow-direction-and-accumulation-rasters"><i class="fa fa-check"></i><b>8.4.6</b> Flow direction and accumulation rasters</a></li>
<li class="chapter" data-level="8.4.7" data-path="dem-processing.html"><a href="dem-processing.html#streams"><i class="fa fa-check"></i><b>8.4.7</b> Streams</a></li>
<li class="chapter" data-level="8.4.8" data-path="dem-processing.html"><a href="dem-processing.html#final-thoughts"><i class="fa fa-check"></i><b>8.4.8</b> Final thoughts:</a></li>
</ul></li>
<li class="chapter" data-level="8.5" data-path="dem-processing.html"><a href="dem-processing.html#transfer-function-rainfall-runoff-models"><i class="fa fa-check"></i><b>8.5</b> Transfer function rainfall-runoff models</a>
<ul>
<li class="chapter" data-level="8.5.1" data-path="dem-processing.html"><a href="dem-processing.html#summary-1"><i class="fa fa-check"></i><b>8.5.1</b> Summary</a></li>
<li class="chapter" data-level="8.5.2" data-path="dem-processing.html"><a href="dem-processing.html#overall-learning-objectives-1"><i class="fa fa-check"></i><b>8.5.2</b> Overall Learning Objectives</a></li>
<li class="chapter" data-level="8.5.3" data-path="dem-processing.html"><a href="dem-processing.html#terminology"><i class="fa fa-check"></i><b>8.5.3</b> Terminology</a></li>
<li class="chapter" data-level="8.5.4" data-path="dem-processing.html"><a href="dem-processing.html#the-linear-time-invariant-tf"><i class="fa fa-check"></i><b>8.5.4</b> The Linear Time-Invariant TF</a></li>
<li class="chapter" data-level="8.5.5" data-path="dem-processing.html"><a href="dem-processing.html#labwork-20-pts-2"><i class="fa fa-check"></i><b>8.5.5</b> Labwork (20 pts)</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantitative Environmental Methods: LRES 546</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="monte-carlo-simulation-20-pnts" class="section level1 hasAnchor" number="3">
<h1><span class="header-section-number">Chapter 3</span> Monte Carlo Simulation (20 pnts)<a href="monte-carlo-simulation-20-pnts.html#monte-carlo-simulation-20-pnts" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="background" class="section level2 hasAnchor" number="3.1">
<h2><span class="header-section-number">3.1</span> Background:<a href="monte-carlo-simulation-20-pnts.html#background" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Monte Carlo Simulation is a method to estimate the probability of the outcomes of an uncertain event. It is based on a law of probability theory that says if we repeat an experiment many times, the average of the results will get closer to the true probability of those outcomes.</p>
<p>First check out this video:
<iframe src="https://www.youtube.com/embed/7TqhmX92P6U" width="672" height="400px" data-external="1"></iframe></p>
<div id="reading" class="section level3 hasAnchor" number="3.1.1">
<h3><span class="header-section-number">3.1.1</span> Reading<a href="monte-carlo-simulation-20-pnts.html#reading" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Then read this: <a href="https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2924739/" class="uri">https://www.ncbi.nlm.nih.gov/pmc/articles/PMC2924739/</a> for a understanding of the fundamentals.</p>
</div>
</div>
<div id="how-does-this-apply-to-hydrological-modeling" class="section level2 hasAnchor" number="3.2">
<h2><span class="header-section-number">3.2</span> How does this apply to hydrological modeling?<a href="monte-carlo-simulation-20-pnts.html#how-does-this-apply-to-hydrological-modeling" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When modeling watershed hydrological processes, we often attempting to quantify<br><br></p>
<ul>
<li>watershed inputs <br>
<ul>
<li>e.g., precipitation <br></li>
</ul></li>
<li>watershed outputs <br>
<ul>
<li>e.g., <a href="https://www.usgs.gov/special-topics/water-science-school/science/evapotranspiration-and-water-cycle#:~:text=Evapotranspiration%20includes%20water%20evaporation%20into,to%20the%20atmosphere%20via%20plants">evapotranspiration</a>, <a href="https://www.usgs.gov/media/images/sublimation-occurs-snow-covered-mountains">sublimation</a>, runoff/discharge <br></li>
</ul></li>
<li>watershed storage <br>
<ul>
<li>precipitation that is not immediately converted to runoff or ET rather stored as snow or subsurface water. <br></li>
</ul></li>
</ul>
<p>Imagine we are trying to predict the percentage of precipitation stored in a watershed after a storm event. We have learned that there are may factors that affect this prediction, like antecedent conditions, that may be difficult to measure directly. Monte Carlo Simulation can offer a valuable approach to estimate the probability of obtaining certain measurements when those factors can not be directly observed or measured. We can approximate the likelihood of specific measurement by simulating a range of possible scenarios. <br></p>
<p>Monte Carlo Simulation is not only useful for estimating probabilities, but for conducting sensitivity analysis. In any model, there are usually several input parameters. Sensitivity analysis helps us understand how changes in these parameters affect the predicted values. To perform a sensitivity analysis using a Monte Carlo Simulation we can:</p>
<ul>
<li>Define the realistic ranges for each parameter we want to analyze</li>
<li>Using Monte Carlo Simulation, randomly sample values from the defined ranges for each parameter</li>
<li>Analyze output to understand how different input sample values affect the predicted output</li>
</ul>
<div id="example" class="section level3 hasAnchor" number="3.2.1">
<h3><span class="header-section-number">3.2.1</span> Example<a href="monte-carlo-simulation-20-pnts.html#example" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Let’s consider all of this in an example model called <a href="https://agupubs.onlinelibrary.wiley.com/doi/full/10.1002/2014WR016719">WECOH - Watershed ECOHydrology</a>. In this study, researchers (Nippgen et al.) were interested in the change in subsurface water storage through time and space on a daily and seasonal basis.</p>
<div class="float">
<img src="images/wrcr21497-fig-0009-m.jpg" style="width:50.0%" alt="Evolution of watershed connectivity" />
<div class="figcaption">Evolution of watershed connectivity</div>
</div>
<p><br/><br/>
The authors directly measured runoff/discharge, collected precipitation data at several points within the watershed, used remote sensing to estimate how much water was lost to evapotranspiration, and used digital elevation models to characterize the watershed topography. As we learned in the hydrograph separation module, topographic characteristics can have a significant impact on storage. <br>
Though resources like <a href="https://websoilsurvey.sc.egov.usda.gov/app/">USDA’s Web Soil Survey</a> can provide a basic understanding underlying geology across a large region, characterizing the heterogeneous nature of soils within a watershed can be logistically unfeasible. To estimate the soil characteristics like storage capacity (how much water the soil can hold) and hydraulic conductivity (how easily water can move through soil) in the study watershed, the authors used available resources to determine the possible range of values for each of their unknown parameters. They then tested thousands of model simulations using randomly selected values with the predetermined range for each of the soil characteristics. They compared the simulated discharge from these simulations to the actual discharge measurements. The simulations that predicted discharge patterns that closely matched reality helped them to estimate the unknown soil properties. Additionally, from the results of these simulations, they could identify which model inputs had the most significant impact on the discharge predictions, and how sensitive the output was to changes in each parameter. In this case, they determined that the model and system were most sensitive to precipitation. This type of sensitivity analysis can help us interpret the relative importance of different parameters and understand the overall sensitivity of the model or system. The study is linked for your reference but a thorough reading is not required.</p>
</div>
<div id="reading-1" class="section level3 hasAnchor" number="3.2.2">
<h3><span class="header-section-number">3.2.2</span> Reading<a href="monte-carlo-simulation-20-pnts.html#reading-1" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>However, do read <a href="https://www.researchgate.net/publication/262765548_Development_of_probability_distributions_for_urban_hydrologic_model_parameters_and_a_Monte_Carlo_analysis_of_model_sensitivity">this methods paper</a> by Knighton et al. for an example of how Monte Carlo Simulation was used to estimate hydraulic conductivity in an urban system with varied land-cover.</p>
</div>
</div>
<div id="how-do-we-generate-a-simulation-with-code" class="section level2 hasAnchor" number="3.3">
<h2><span class="header-section-number">3.3</span> How do we generate a simulation with code?<a href="monte-carlo-simulation-20-pnts.html#how-do-we-generate-a-simulation-with-code" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>For a 12-minute example in RStudio, check this out. If you are still learning the basics of R functionality, it may be helpful to code along with this video, pausing as needed. Note that this instruction is coding in an Rscript (after opening RStudio &gt; File &gt; New File &gt; R Script), rather than an Rmarkdown that we use in this class.</p>
<iframe src="https://www.youtube.com/embed/inJsu-ygBfM" width="672" height="400px" data-external="1">
</iframe>
</div>
<div id="codework" class="section level2 hasAnchor" number="3.4">
<h2><span class="header-section-number">3.4</span> Codework<a href="monte-carlo-simulation-20-pnts.html#codework" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="download-the-repo-for-this-lab-here" class="section level3 hasAnchor" number="3.4.1">
<h3><span class="header-section-number">3.4.1</span> <a href="https://github.com/tpcovino/05_monte_carlo.git" target="_blank">Download the repo for this lab HERE</a><a href="monte-carlo-simulation-20-pnts.html#download-the-repo-for-this-lab-here" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this lab/homework, you will use the transfer function model from the previous module for some sensitivity analysis using Monte Carlo simulations. The code is mostly the same as last module with some small adjustments to save the parameters from each Monte Carlo run. As a reminder, in the Monte Carlo analysis, we will run the model x number of times, save the parameters and evaluate the fit after each run. After the completion of the MC runs, we will use the GLUE method to evaluate parameter sensitivity. There are three main objectives for this homework:<br />
1) Set up the Monte Carlo analysis
2) Run the MC simulation for ONE of the years in the study period and perform a GLUE sensitivity analysis<br />
3) Compare the different objective functions.</p>
<p>A lot of the code in this homework will be provided.</p>
</div>
<div id="setup" class="section level3 hasAnchor" number="3.4.2">
<h3><span class="header-section-number">3.4.2</span> Setup<a href="monte-carlo-simulation-20-pnts.html#setup" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>Import packages, including the “progress” and “tictoc” packages. These will allow us to time our loops and functions</p>
<p>Read data - this is the same PQ data we have worked with in previous modules.</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="monte-carlo-simulation-20-pnts.html#cb28-1" tabindex="-1"></a><span class="co"># rm(list = ls(all = TRUE)) # clear global environment</span></span>
<span id="cb28-2"><a href="monte-carlo-simulation-20-pnts.html#cb28-2" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-3"><a href="monte-carlo-simulation-20-pnts.html#cb28-3" tabindex="-1"></a><span class="co"># indata &lt;- read_csv(&quot;P_Q_1996_2011.csv&quot;)</span></span>
<span id="cb28-4"><a href="monte-carlo-simulation-20-pnts.html#cb28-4" tabindex="-1"></a><span class="co"># indata &lt;- indata %&gt;%</span></span>
<span id="cb28-5"><a href="monte-carlo-simulation-20-pnts.html#cb28-5" tabindex="-1"></a><span class="co">#   mutate(Date = mdy(Date)) %&gt;% # bring the date colum in shape</span></span>
<span id="cb28-6"><a href="monte-carlo-simulation-20-pnts.html#cb28-6" tabindex="-1"></a><span class="co">#   mutate(wtr_yr = if_else(month(Date) &gt; 9, year(Date) + 1, year(Date))) # create a water year column</span></span>
<span id="cb28-7"><a href="monte-carlo-simulation-20-pnts.html#cb28-7" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb28-8"><a href="monte-carlo-simulation-20-pnts.html#cb28-8" tabindex="-1"></a><span class="co"># # choose the 2006 water year</span></span>
<span id="cb28-9"><a href="monte-carlo-simulation-20-pnts.html#cb28-9" tabindex="-1"></a><span class="co"># PQ &lt;- indata %&gt;%</span></span>
<span id="cb28-10"><a href="monte-carlo-simulation-20-pnts.html#cb28-10" tabindex="-1"></a><span class="co">#   filter(wtr_yr == 2006)</span></span></code></pre></div>
<p>Define variables</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="monte-carlo-simulation-20-pnts.html#cb29-1" tabindex="-1"></a><span class="co"># tau &lt;- 1:nrow(PQ) # simple timestep counter</span></span>
<span id="cb29-2"><a href="monte-carlo-simulation-20-pnts.html#cb29-2" tabindex="-1"></a><span class="co"># Pobs &lt;- PQ$RainMelt_mm # observed precipitation</span></span>
<span id="cb29-3"><a href="monte-carlo-simulation-20-pnts.html#cb29-3" tabindex="-1"></a><span class="co"># Qobs &lt;- PQ$Discharge_mm # observed streamflow</span></span></code></pre></div>
</div>
<div id="parameter-initialization" class="section level3 hasAnchor" number="3.4.3">
<h3><span class="header-section-number">3.4.3</span> Parameter initialization<a href="monte-carlo-simulation-20-pnts.html#parameter-initialization" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This chunk has two purposes. The first is to set up the number of iterations for the Monte Carlo simulation. The entire model code is essentially wrapped into the main MC for loop. Each iteration of that loop is one full model realization: loss function, TF, convolution, model fit assessment (objective function). For each model run (each MC iteration), we will save the model parameters and respective objective functions in a dataframe. This will be the main source for the GLUE sensitivity analysis at the end. The model parameters are sampled in the main model chunk, this is just the preallocation of the dataframe.<br />
You will both run your own MC simulation, to set up the code, but will also receive a .Rdata file with 100,000 runs to give you more behavioral runs for the sensitivity analysis and uncertainty bounds. As a tip, while setting up the code, I would recommend setting the number of MC iterations to something low, for example 10 or maybe even 1. Once you have confirmed that your code works, crank up the number of iterations. Set it to 1000 to see how many behavioral runs you get. After that, load the file with the provided runs.</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="monte-carlo-simulation-20-pnts.html#cb30-1" tabindex="-1"></a><span class="co"># nx sets the number of Monte Carlo runs</span></span>
<span id="cb30-2"><a href="monte-carlo-simulation-20-pnts.html#cb30-2" tabindex="-1"></a><span class="co"># nx &lt;- 100 # number of runs</span></span>
<span id="cb30-3"><a href="monte-carlo-simulation-20-pnts.html#cb30-3" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb30-4"><a href="monte-carlo-simulation-20-pnts.html#cb30-4" tabindex="-1"></a><span class="co"># # set up the parameter matrix for the loss function, transfer function, and objective functions</span></span>
<span id="cb30-5"><a href="monte-carlo-simulation-20-pnts.html#cb30-5" tabindex="-1"></a><span class="co"># param &lt;- tibble(</span></span>
<span id="cb30-6"><a href="monte-carlo-simulation-20-pnts.html#cb30-6" tabindex="-1"></a><span class="co">#   Run = vector(mode = &quot;double&quot;, nx), # counter for model run</span></span>
<span id="cb30-7"><a href="monte-carlo-simulation-20-pnts.html#cb30-7" tabindex="-1"></a><span class="co">#   b1 = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb30-8"><a href="monte-carlo-simulation-20-pnts.html#cb30-8" tabindex="-1"></a><span class="co">#   b2 = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb30-9"><a href="monte-carlo-simulation-20-pnts.html#cb30-9" tabindex="-1"></a><span class="co">#   b3 = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb30-10"><a href="monte-carlo-simulation-20-pnts.html#cb30-10" tabindex="-1"></a><span class="co">#   a = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb30-11"><a href="monte-carlo-simulation-20-pnts.html#cb30-11" tabindex="-1"></a><span class="co">#   b = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb30-12"><a href="monte-carlo-simulation-20-pnts.html#cb30-12" tabindex="-1"></a><span class="co">#   nse = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb30-13"><a href="monte-carlo-simulation-20-pnts.html#cb30-13" tabindex="-1"></a><span class="co">#   kge = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb30-14"><a href="monte-carlo-simulation-20-pnts.html#cb30-14" tabindex="-1"></a><span class="co">#   rmse = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb30-15"><a href="monte-carlo-simulation-20-pnts.html#cb30-15" tabindex="-1"></a><span class="co">#   mae = vector(mode = &quot;double&quot;, nx)</span></span>
<span id="cb30-16"><a href="monte-carlo-simulation-20-pnts.html#cb30-16" tabindex="-1"></a><span class="co"># )</span></span></code></pre></div>
</div>
<div id="mc-model-run" class="section level3 hasAnchor" number="3.4.4">
<h3><span class="header-section-number">3.4.4</span> MC Model run<a href="monte-carlo-simulation-20-pnts.html#mc-model-run" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>This is the main model chunk. The tic() and toc() statements measure the execution time for the whole chunk. There is also a progressbar in the chunk that will run in the console and inform you about the progress of the MC simulation. The loss function parameters are set in the loss function, the TF parameters in the loss function code. For each loop iteration, we will store the parameter values and the simulated discharge in the “param” dataframe. So, if we ran the MC simulation 100 times, we would end up with 100 parameter combinations and simulated discharges.</p>
<p><strong>Q1 (3 pt) How are the loss function and TF parameters being sampled? That is, what is the underlying distribution and why did we choose it? (2-3 sentences)</strong><br />
ANSWER:</p>
<p><strong>Extra point: What does the while loop do in the TF calculation? And why is it in there? (1-2 sentences)</strong><br />
ANSWER:</p>
<p>Save or load data</p>
<p>After setting up the MC simulation, we will actually use a pre-created dataset. Running the MC simulation tens of thousands of times will take multiple hours. For that reason, we will use an existing data set.</p>
<div class="sourceCode" id="cb31"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb31-1"><a href="monte-carlo-simulation-20-pnts.html#cb31-1" tabindex="-1"></a><span class="co"># save.image(file = &#39;AllData.RData&#39;)</span></span>
<span id="cb31-2"><a href="monte-carlo-simulation-20-pnts.html#cb31-2" tabindex="-1"></a></span>
<span id="cb31-3"><a href="monte-carlo-simulation-20-pnts.html#cb31-3" tabindex="-1"></a><span class="co"># load the MC data</span></span>
<span id="cb31-4"><a href="monte-carlo-simulation-20-pnts.html#cb31-4" tabindex="-1"></a><span class="co"># load(&quot;AllData.RData&quot;)</span></span></code></pre></div>
<p>Best run</p>
<p>Now that we have the dataframe with all parameter combinations and all efficiencies, we can plot the best simulation and compare it to the observed discharge</p>
<div class="sourceCode" id="cb32"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb32-1"><a href="monte-carlo-simulation-20-pnts.html#cb32-1" tabindex="-1"></a><span class="co"># # take the best run (i.e., first row in param df), unlist the simulated discharge, and store it in a dataframe</span></span>
<span id="cb32-2"><a href="monte-carlo-simulation-20-pnts.html#cb32-2" tabindex="-1"></a><span class="co"># PQ$Qsim &lt;- unlist(param$qsim[1])</span></span>
<span id="cb32-3"><a href="monte-carlo-simulation-20-pnts.html#cb32-3" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-4"><a href="monte-carlo-simulation-20-pnts.html#cb32-4" tabindex="-1"></a><span class="co"># # make long form</span></span>
<span id="cb32-5"><a href="monte-carlo-simulation-20-pnts.html#cb32-5" tabindex="-1"></a><span class="co"># PQ_long &lt;- PQ %&gt;%</span></span>
<span id="cb32-6"><a href="monte-carlo-simulation-20-pnts.html#cb32-6" tabindex="-1"></a><span class="co">#   select(-wtr_yr, -RainMelt_mm) %&gt;% # remove the water year and rainmelt columns</span></span>
<span id="cb32-7"><a href="monte-carlo-simulation-20-pnts.html#cb32-7" tabindex="-1"></a><span class="co">#   pivot_longer(names_to = &quot;key&quot;, values_to = &quot;value&quot;, -Date)</span></span>
<span id="cb32-8"><a href="monte-carlo-simulation-20-pnts.html#cb32-8" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb32-9"><a href="monte-carlo-simulation-20-pnts.html#cb32-9" tabindex="-1"></a><span class="co"># # plot observed and best simulated discharge in the same figure against the date</span></span>
<span id="cb32-10"><a href="monte-carlo-simulation-20-pnts.html#cb32-10" tabindex="-1"></a><span class="co"># ggplot(PQ_long, aes(x = Date, y = value, color = key)) +</span></span>
<span id="cb32-11"><a href="monte-carlo-simulation-20-pnts.html#cb32-11" tabindex="-1"></a><span class="co">#   theme_bw(base_size = 15) +</span></span>
<span id="cb32-12"><a href="monte-carlo-simulation-20-pnts.html#cb32-12" tabindex="-1"></a><span class="co">#   geom_line() +</span></span>
<span id="cb32-13"><a href="monte-carlo-simulation-20-pnts.html#cb32-13" tabindex="-1"></a><span class="co">#   labs(y = &quot;Discharge (mm/day)&quot;, color = {</span></span>
<span id="cb32-14"><a href="monte-carlo-simulation-20-pnts.html#cb32-14" tabindex="-1"></a><span class="co">#   })</span></span></code></pre></div>
</div>
<div id="sensitivity-analysis" class="section level3 hasAnchor" number="3.4.5">
<h3><span class="header-section-number">3.4.5</span> Sensitivity analysis<a href="monte-carlo-simulation-20-pnts.html#sensitivity-analysis" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will use the GLUE methodology to assess parameter sensitivity. We will use GLUE for two things: 1) To assess parameter sensitivity, and 2) to create an envelope of model simulations. For the first step, we need to bring the data into shape so that we can plot dotty plots and density plots. We will use NSE for this.
You want to plot each parameter in its own box. Look up facet_wrap() for how to do this! You want the axis scaling to be “free”.</p>
<div class="sourceCode" id="cb33"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb33-1"><a href="monte-carlo-simulation-20-pnts.html#cb33-1" tabindex="-1"></a><span class="co"># # select columns and make long form data</span></span>
<span id="cb33-2"><a href="monte-carlo-simulation-20-pnts.html#cb33-2" tabindex="-1"></a><span class="co"># param_long &lt;- param %&gt;%</span></span>
<span id="cb33-3"><a href="monte-carlo-simulation-20-pnts.html#cb33-3" tabindex="-1"></a><span class="co">#   select(-Run, -kge, -rmse, -mae, -qsim) %&gt;% # remove unnecessary columns. We only want the five parameters and nse</span></span>
<span id="cb33-4"><a href="monte-carlo-simulation-20-pnts.html#cb33-4" tabindex="-1"></a><span class="co">#   pivot_longer(names_to = &quot;key&quot;, values_to = &quot;value&quot;, -nse) # make long form</span></span>
<span id="cb33-5"><a href="monte-carlo-simulation-20-pnts.html#cb33-5" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-6"><a href="monte-carlo-simulation-20-pnts.html#cb33-6" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-7"><a href="monte-carlo-simulation-20-pnts.html#cb33-7" tabindex="-1"></a><span class="co"># # set nse cutoff for behavioral model simulations. use 0.7 as threshold</span></span>
<span id="cb33-8"><a href="monte-carlo-simulation-20-pnts.html#cb33-8" tabindex="-1"></a><span class="co"># cutoff &lt;- 0.8</span></span>
<span id="cb33-9"><a href="monte-carlo-simulation-20-pnts.html#cb33-9" tabindex="-1"></a><span class="co"># param_long &lt;- param_long %&gt;%</span></span>
<span id="cb33-10"><a href="monte-carlo-simulation-20-pnts.html#cb33-10" tabindex="-1"></a><span class="co">#   filter(nse &gt; cutoff) # use filter() to only use runs with nse greater than the cutoff</span></span>
<span id="cb33-11"><a href="monte-carlo-simulation-20-pnts.html#cb33-11" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-12"><a href="monte-carlo-simulation-20-pnts.html#cb33-12" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-13"><a href="monte-carlo-simulation-20-pnts.html#cb33-13" tabindex="-1"></a><span class="co"># # dotty plots</span></span>
<span id="cb33-14"><a href="monte-carlo-simulation-20-pnts.html#cb33-14" tabindex="-1"></a><span class="co"># ggplot(param_long, aes(x = value, y = nse)) + # x is parameter value, y is nse value</span></span>
<span id="cb33-15"><a href="monte-carlo-simulation-20-pnts.html#cb33-15" tabindex="-1"></a><span class="co">#   geom_point() + # plot as points</span></span>
<span id="cb33-16"><a href="monte-carlo-simulation-20-pnts.html#cb33-16" tabindex="-1"></a><span class="co">#   facet_wrap(vars(key), scales = &quot;free&quot;) + # facets are the individual parameters</span></span>
<span id="cb33-17"><a href="monte-carlo-simulation-20-pnts.html#cb33-17" tabindex="-1"></a><span class="co">#   ylim(cutoff, 1) + # sets obj fct axis limit from the cutoff value to 1</span></span>
<span id="cb33-18"><a href="monte-carlo-simulation-20-pnts.html#cb33-18" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb33-19"><a href="monte-carlo-simulation-20-pnts.html#cb33-19" tabindex="-1"></a><span class="co">#     strip.text = element_text(face = &quot;bold&quot;, size = 8),</span></span>
<span id="cb33-20"><a href="monte-carlo-simulation-20-pnts.html#cb33-20" tabindex="-1"></a><span class="co">#     strip.background = element_rect(</span></span>
<span id="cb33-21"><a href="monte-carlo-simulation-20-pnts.html#cb33-21" tabindex="-1"></a><span class="co">#       fill = &quot;gray95&quot;,</span></span>
<span id="cb33-22"><a href="monte-carlo-simulation-20-pnts.html#cb33-22" tabindex="-1"></a><span class="co">#       colour = &quot;gray&quot;,</span></span>
<span id="cb33-23"><a href="monte-carlo-simulation-20-pnts.html#cb33-23" tabindex="-1"></a><span class="co">#       size = 0.5</span></span>
<span id="cb33-24"><a href="monte-carlo-simulation-20-pnts.html#cb33-24" tabindex="-1"></a><span class="co">#       )</span></span>
<span id="cb33-25"><a href="monte-carlo-simulation-20-pnts.html#cb33-25" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb33-26"><a href="monte-carlo-simulation-20-pnts.html#cb33-26" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-27"><a href="monte-carlo-simulation-20-pnts.html#cb33-27" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-28"><a href="monte-carlo-simulation-20-pnts.html#cb33-28" tabindex="-1"></a><span class="co"># # density plots</span></span>
<span id="cb33-29"><a href="monte-carlo-simulation-20-pnts.html#cb33-29" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb33-30"><a href="monte-carlo-simulation-20-pnts.html#cb33-30" tabindex="-1"></a><span class="co">#   theme_bw(base_size = 15) +</span></span>
<span id="cb33-31"><a href="monte-carlo-simulation-20-pnts.html#cb33-31" tabindex="-1"></a><span class="co">#   geom_density(data = param_long, aes(x = value)) + # geom_density() to plot the density</span></span>
<span id="cb33-32"><a href="monte-carlo-simulation-20-pnts.html#cb33-32" tabindex="-1"></a><span class="co">#   facet_wrap(~key, scales = &quot;free&quot;) + # facet_wrap() to get each parameter in its own box</span></span>
<span id="cb33-33"><a href="monte-carlo-simulation-20-pnts.html#cb33-33" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb33-34"><a href="monte-carlo-simulation-20-pnts.html#cb33-34" tabindex="-1"></a><span class="co">#     strip.text = element_text(face = &quot;bold&quot;, size = 8),</span></span>
<span id="cb33-35"><a href="monte-carlo-simulation-20-pnts.html#cb33-35" tabindex="-1"></a><span class="co">#     strip.background = element_rect(</span></span>
<span id="cb33-36"><a href="monte-carlo-simulation-20-pnts.html#cb33-36" tabindex="-1"></a><span class="co">#       fill = &quot;gray95&quot;,</span></span>
<span id="cb33-37"><a href="monte-carlo-simulation-20-pnts.html#cb33-37" tabindex="-1"></a><span class="co">#       colour = &quot;gray&quot;,</span></span>
<span id="cb33-38"><a href="monte-carlo-simulation-20-pnts.html#cb33-38" tabindex="-1"></a><span class="co">#       size = 0.5</span></span>
<span id="cb33-39"><a href="monte-carlo-simulation-20-pnts.html#cb33-39" tabindex="-1"></a><span class="co">#       )</span></span>
<span id="cb33-40"><a href="monte-carlo-simulation-20-pnts.html#cb33-40" tabindex="-1"></a><span class="co">#   )</span></span>
<span id="cb33-41"><a href="monte-carlo-simulation-20-pnts.html#cb33-41" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-42"><a href="monte-carlo-simulation-20-pnts.html#cb33-42" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb33-43"><a href="monte-carlo-simulation-20-pnts.html#cb33-43" tabindex="-1"></a><span class="co"># # 2d density plots</span></span>
<span id="cb33-44"><a href="monte-carlo-simulation-20-pnts.html#cb33-44" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb33-45"><a href="monte-carlo-simulation-20-pnts.html#cb33-45" tabindex="-1"></a><span class="co">#   geom_density_2d_filled( # geom_density_2d_filled() for the actual density plot</span></span>
<span id="cb33-46"><a href="monte-carlo-simulation-20-pnts.html#cb33-46" tabindex="-1"></a><span class="co">#     data = param_long,</span></span>
<span id="cb33-47"><a href="monte-carlo-simulation-20-pnts.html#cb33-47" tabindex="-1"></a><span class="co">#     aes(x = value, y = nse),</span></span>
<span id="cb33-48"><a href="monte-carlo-simulation-20-pnts.html#cb33-48" tabindex="-1"></a><span class="co">#     alpha = 1,</span></span>
<span id="cb33-49"><a href="monte-carlo-simulation-20-pnts.html#cb33-49" tabindex="-1"></a><span class="co">#     contour_var = &quot;ndensity&quot;</span></span>
<span id="cb33-50"><a href="monte-carlo-simulation-20-pnts.html#cb33-50" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb33-51"><a href="monte-carlo-simulation-20-pnts.html#cb33-51" tabindex="-1"></a><span class="co">#   geom_point( # geom_point() to show the indivudal runs</span></span>
<span id="cb33-52"><a href="monte-carlo-simulation-20-pnts.html#cb33-52" tabindex="-1"></a><span class="co">#     data = param_long,</span></span>
<span id="cb33-53"><a href="monte-carlo-simulation-20-pnts.html#cb33-53" tabindex="-1"></a><span class="co">#     aes(x = value, y = nse),</span></span>
<span id="cb33-54"><a href="monte-carlo-simulation-20-pnts.html#cb33-54" tabindex="-1"></a><span class="co">#     shape = 1,</span></span>
<span id="cb33-55"><a href="monte-carlo-simulation-20-pnts.html#cb33-55" tabindex="-1"></a><span class="co">#     alpha = 0.2,</span></span>
<span id="cb33-56"><a href="monte-carlo-simulation-20-pnts.html#cb33-56" tabindex="-1"></a><span class="co">#     size = 0.5,</span></span>
<span id="cb33-57"><a href="monte-carlo-simulation-20-pnts.html#cb33-57" tabindex="-1"></a><span class="co">#     stroke = 0.2,</span></span>
<span id="cb33-58"><a href="monte-carlo-simulation-20-pnts.html#cb33-58" tabindex="-1"></a><span class="co">#     color = &quot;black&quot;</span></span>
<span id="cb33-59"><a href="monte-carlo-simulation-20-pnts.html#cb33-59" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb33-60"><a href="monte-carlo-simulation-20-pnts.html#cb33-60" tabindex="-1"></a><span class="co">#   theme_bw(base_size = 15) +</span></span>
<span id="cb33-61"><a href="monte-carlo-simulation-20-pnts.html#cb33-61" tabindex="-1"></a><span class="co">#   facet_wrap(~key, scales = &quot;free&quot;) +</span></span>
<span id="cb33-62"><a href="monte-carlo-simulation-20-pnts.html#cb33-62" tabindex="-1"></a><span class="co">#   theme(</span></span>
<span id="cb33-63"><a href="monte-carlo-simulation-20-pnts.html#cb33-63" tabindex="-1"></a><span class="co">#     strip.text = element_text(face = &quot;bold&quot;, size = 8),</span></span>
<span id="cb33-64"><a href="monte-carlo-simulation-20-pnts.html#cb33-64" tabindex="-1"></a><span class="co">#     strip.background = element_rect(</span></span>
<span id="cb33-65"><a href="monte-carlo-simulation-20-pnts.html#cb33-65" tabindex="-1"></a><span class="co">#       fill = &quot;gray95&quot;,</span></span>
<span id="cb33-66"><a href="monte-carlo-simulation-20-pnts.html#cb33-66" tabindex="-1"></a><span class="co">#       colour = &quot;gray&quot;,</span></span>
<span id="cb33-67"><a href="monte-carlo-simulation-20-pnts.html#cb33-67" tabindex="-1"></a><span class="co">#       linewidth = 0.5</span></span>
<span id="cb33-68"><a href="monte-carlo-simulation-20-pnts.html#cb33-68" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb33-69"><a href="monte-carlo-simulation-20-pnts.html#cb33-69" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb33-70"><a href="monte-carlo-simulation-20-pnts.html#cb33-70" tabindex="-1"></a><span class="co">#   labs(x = &quot;Value&quot;, y = &quot;NSE (-)&quot;) +</span></span>
<span id="cb33-71"><a href="monte-carlo-simulation-20-pnts.html#cb33-71" tabindex="-1"></a><span class="co">#   theme(legend.title = element_blank(), legend.position = &quot;none&quot;)</span></span></code></pre></div>
<p><strong>Q2 (5 pts) Describe the sensitivity analysis with the three different plots. Are the parameters sensitive? Which ones are, which ones are not? Does this affect your “trust” in the model? (5-8 sentences)</strong><br />
ANSWER:</p>
<p><strong>Q3 (4 pts) What are the differences between the dotty plots and the density plots? What are the differences between the two density plots? (2-3 sentences)</strong> ANSWER:</p>
<p>Uncertainty bounds
In this chunk, we will generate uncertainty bounds for the simulation. We will again only use the runs that we identified as behavioral.</p>
<div class="sourceCode" id="cb34"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb34-1"><a href="monte-carlo-simulation-20-pnts.html#cb34-1" tabindex="-1"></a><span class="co"># # remove non-behavioral runs using the cutoff</span></span>
<span id="cb34-2"><a href="monte-carlo-simulation-20-pnts.html#cb34-2" tabindex="-1"></a><span class="co"># param_ci &lt;- param %&gt;%</span></span>
<span id="cb34-3"><a href="monte-carlo-simulation-20-pnts.html#cb34-3" tabindex="-1"></a><span class="co">#   filter(nse &gt; 0.872) # only use obj function (nse) values above the previously defined threshold</span></span>
<span id="cb34-4"><a href="monte-carlo-simulation-20-pnts.html#cb34-4" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb34-5"><a href="monte-carlo-simulation-20-pnts.html#cb34-5" tabindex="-1"></a><span class="co"># # make df with all of the top runs. this saves each of the top simulated Q time series in its own column.</span></span>
<span id="cb34-6"><a href="monte-carlo-simulation-20-pnts.html#cb34-6" tabindex="-1"></a><span class="co"># # the columns are called V1 through Vn, with V1 being the best simulation and Vn the worst simulation of the behavioral runs.</span></span>
<span id="cb34-7"><a href="monte-carlo-simulation-20-pnts.html#cb34-7" tabindex="-1"></a><span class="co"># Qruns &lt;-</span></span>
<span id="cb34-8"><a href="monte-carlo-simulation-20-pnts.html#cb34-8" tabindex="-1"></a><span class="co">#   as_tibble(matrix(</span></span>
<span id="cb34-9"><a href="monte-carlo-simulation-20-pnts.html#cb34-9" tabindex="-1"></a><span class="co">#     unlist(param_ci$qsim),</span></span>
<span id="cb34-10"><a href="monte-carlo-simulation-20-pnts.html#cb34-10" tabindex="-1"></a><span class="co">#     ncol = nrow(param_ci),</span></span>
<span id="cb34-11"><a href="monte-carlo-simulation-20-pnts.html#cb34-11" tabindex="-1"></a><span class="co">#     byrow = F</span></span>
<span id="cb34-12"><a href="monte-carlo-simulation-20-pnts.html#cb34-12" tabindex="-1"></a><span class="co">#   ), .name_repair = NULL)</span></span>
<span id="cb34-13"><a href="monte-carlo-simulation-20-pnts.html#cb34-13" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb34-14"><a href="monte-carlo-simulation-20-pnts.html#cb34-14" tabindex="-1"></a><span class="co"># # combine Qruns with date and observed runoff from the PQ data frame. additionally, calculate mins and maxs</span></span>
<span id="cb34-15"><a href="monte-carlo-simulation-20-pnts.html#cb34-15" tabindex="-1"></a><span class="co"># Qruns &lt;-</span></span>
<span id="cb34-16"><a href="monte-carlo-simulation-20-pnts.html#cb34-16" tabindex="-1"></a><span class="co">#   bind_cols(Date = PQ$Date, Qruns) %&gt;% # bind_cols() to combine Date, RainMelt_mm, and Qruns</span></span>
<span id="cb34-17"><a href="monte-carlo-simulation-20-pnts.html#cb34-17" tabindex="-1"></a><span class="co">#   mutate(Qmin = apply(Qruns, 1, min)) %&gt;% # get the rowmin for simulated Qs</span></span>
<span id="cb34-18"><a href="monte-carlo-simulation-20-pnts.html#cb34-18" tabindex="-1"></a><span class="co">#   mutate(Qmax = apply(Qruns, 1, max)) # get the rowmax for simualted Qs</span></span>
<span id="cb34-19"><a href="monte-carlo-simulation-20-pnts.html#cb34-19" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb34-20"><a href="monte-carlo-simulation-20-pnts.html#cb34-20" tabindex="-1"></a><span class="co"># # long form</span></span>
<span id="cb34-21"><a href="monte-carlo-simulation-20-pnts.html#cb34-21" tabindex="-1"></a><span class="co"># Qruns_long &lt;- Qruns %&gt;%</span></span>
<span id="cb34-22"><a href="monte-carlo-simulation-20-pnts.html#cb34-22" tabindex="-1"></a><span class="co">#   # select(-Discharge_mm, -Qsim) %&gt;% # remove observed and best simulated discharge</span></span>
<span id="cb34-23"><a href="monte-carlo-simulation-20-pnts.html#cb34-23" tabindex="-1"></a><span class="co">#   pivot_longer(names_to = &quot;key&quot;, values_to = &quot;value&quot;, -Date) # make long form</span></span>
<span id="cb34-24"><a href="monte-carlo-simulation-20-pnts.html#cb34-24" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb34-25"><a href="monte-carlo-simulation-20-pnts.html#cb34-25" tabindex="-1"></a><span class="co"># # plot with all simulated runs</span></span>
<span id="cb34-26"><a href="monte-carlo-simulation-20-pnts.html#cb34-26" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb34-27"><a href="monte-carlo-simulation-20-pnts.html#cb34-27" tabindex="-1"></a><span class="co">#   geom_line(data = Qruns_long, aes(x = Date, y = value, color = key)) + # plot of all simulated runs. Use Qruns_long here.</span></span>
<span id="cb34-28"><a href="monte-carlo-simulation-20-pnts.html#cb34-28" tabindex="-1"></a><span class="co">#   guides(color=FALSE) +</span></span>
<span id="cb34-29"><a href="monte-carlo-simulation-20-pnts.html#cb34-29" tabindex="-1"></a><span class="co">#   geom_line(</span></span>
<span id="cb34-30"><a href="monte-carlo-simulation-20-pnts.html#cb34-30" tabindex="-1"></a><span class="co">#     data = Qruns,</span></span>
<span id="cb34-31"><a href="monte-carlo-simulation-20-pnts.html#cb34-31" tabindex="-1"></a><span class="co">#     aes(x = Date, y = V1, color = &quot;Best run&quot;),</span></span>
<span id="cb34-32"><a href="monte-carlo-simulation-20-pnts.html#cb34-32" tabindex="-1"></a><span class="co">#     size = 1</span></span>
<span id="cb34-33"><a href="monte-carlo-simulation-20-pnts.html#cb34-33" tabindex="-1"></a><span class="co">#   ) + # plot of best simulation. Use Qruns here. V1 is the best simulated discharge</span></span>
<span id="cb34-34"><a href="monte-carlo-simulation-20-pnts.html#cb34-34" tabindex="-1"></a><span class="co">#   labs(y = &quot;Q (mm/day)&quot;, x = {</span></span>
<span id="cb34-35"><a href="monte-carlo-simulation-20-pnts.html#cb34-35" tabindex="-1"></a><span class="co">#   }, color = {</span></span>
<span id="cb34-36"><a href="monte-carlo-simulation-20-pnts.html#cb34-36" tabindex="-1"></a><span class="co">#   })</span></span>
<span id="cb34-37"><a href="monte-carlo-simulation-20-pnts.html#cb34-37" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb34-38"><a href="monte-carlo-simulation-20-pnts.html#cb34-38" tabindex="-1"></a><span class="co"># # real min and max envelope. You need Qruns for the simulated Q and envelope and PQ to plot the observed streamflow.</span></span>
<span id="cb34-39"><a href="monte-carlo-simulation-20-pnts.html#cb34-39" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb34-40"><a href="monte-carlo-simulation-20-pnts.html#cb34-40" tabindex="-1"></a><span class="co">#   geom_ribbon(data = Qruns, aes(x = Date, ymin = Qmin, ymax = Qmax)) + # plot of envelopes. look up geom function that allows you to plot a shaded area between two lines</span></span>
<span id="cb34-41"><a href="monte-carlo-simulation-20-pnts.html#cb34-41" tabindex="-1"></a><span class="co">#   # plot the best simulated run. remember, that is V1 in the Qruns df</span></span>
<span id="cb34-42"><a href="monte-carlo-simulation-20-pnts.html#cb34-42" tabindex="-1"></a><span class="co">#   geom_line(</span></span>
<span id="cb34-43"><a href="monte-carlo-simulation-20-pnts.html#cb34-43" tabindex="-1"></a><span class="co">#     data = Qruns,</span></span>
<span id="cb34-44"><a href="monte-carlo-simulation-20-pnts.html#cb34-44" tabindex="-1"></a><span class="co">#     aes(x = Date, y = V1, color = &quot;Best run&quot;),</span></span>
<span id="cb34-45"><a href="monte-carlo-simulation-20-pnts.html#cb34-45" tabindex="-1"></a><span class="co">#     size = 0.6</span></span>
<span id="cb34-46"><a href="monte-carlo-simulation-20-pnts.html#cb34-46" tabindex="-1"></a><span class="co">#   ) + # plot of best simulation</span></span>
<span id="cb34-47"><a href="monte-carlo-simulation-20-pnts.html#cb34-47" tabindex="-1"></a><span class="co">#   geom_line(</span></span>
<span id="cb34-48"><a href="monte-carlo-simulation-20-pnts.html#cb34-48" tabindex="-1"></a><span class="co">#     data = PQ,</span></span>
<span id="cb34-49"><a href="monte-carlo-simulation-20-pnts.html#cb34-49" tabindex="-1"></a><span class="co">#     aes(x = Date, y = Discharge_mm, color = &quot;Observed Q&quot;),</span></span>
<span id="cb34-50"><a href="monte-carlo-simulation-20-pnts.html#cb34-50" tabindex="-1"></a><span class="co">#     size = 0.6</span></span>
<span id="cb34-51"><a href="monte-carlo-simulation-20-pnts.html#cb34-51" tabindex="-1"></a><span class="co">#   ) + # plot of observed Q</span></span>
<span id="cb34-52"><a href="monte-carlo-simulation-20-pnts.html#cb34-52" tabindex="-1"></a><span class="co">#   labs(y = &quot;Q (mm/day)&quot;, x = {</span></span>
<span id="cb34-53"><a href="monte-carlo-simulation-20-pnts.html#cb34-53" tabindex="-1"></a><span class="co">#   }, color = {</span></span>
<span id="cb34-54"><a href="monte-carlo-simulation-20-pnts.html#cb34-54" tabindex="-1"></a><span class="co">#   })</span></span></code></pre></div>
<p><strong>Q4 (2 pts) Describe what the envelope actually is. Could we say we are dealing with confidence or prediction intervals? (2-3 sentences)</strong><br />
ANSWER:</p>
<p><strong>Q5 (3 pts) If you inspect the individual model runs (in the Qruns df), you will notice that they all perform somewhat poorly when it comes to the initial baseflow. Why is that and what could you do to change this? (Note: you don’t have to actually do this, just describe how you might approach that issue (2-3 sentences)</strong><br />
ANSWER:</p>
<p><strong>Q6 (3 pts) Plot AND compare the best model run for the four objective functions. Note: This requires you to completely examine the figure generated in the previous code chunk. Remember that you can zoom into the plot to better see differences in peakflow and baseflow, timing, etc.(4+ sentences) </strong><br />
ANSWER:</p>
<p>The coding steps are: 1) get the simulated q vector with the best run for each objective function, 2) put them in a dataframe/tibble, 3) create the long form, 4) plot the long form dataframe/tibble. These steps are just ONE possible outline how the coding steps can be broken up.</p>
<div class="sourceCode" id="cb35"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb35-1"><a href="monte-carlo-simulation-20-pnts.html#cb35-1" tabindex="-1"></a><span class="co"># # sort the param dataframe to select the best objective functions and unlist the relevant qsim values from the initial param dataset</span></span>
<span id="cb35-2"><a href="monte-carlo-simulation-20-pnts.html#cb35-2" tabindex="-1"></a><span class="co"># param &lt;- arrange(param, desc(param$nse)) # nse</span></span>
<span id="cb35-3"><a href="monte-carlo-simulation-20-pnts.html#cb35-3" tabindex="-1"></a><span class="co"># q1 &lt;- unlist(param$qsim[1])</span></span>
<span id="cb35-4"><a href="monte-carlo-simulation-20-pnts.html#cb35-4" tabindex="-1"></a><span class="co"># param &lt;- arrange(param, desc(param$kge)) # kge</span></span>
<span id="cb35-5"><a href="monte-carlo-simulation-20-pnts.html#cb35-5" tabindex="-1"></a><span class="co"># q2 &lt;- unlist(param$qsim[1])</span></span>
<span id="cb35-6"><a href="monte-carlo-simulation-20-pnts.html#cb35-6" tabindex="-1"></a><span class="co"># param &lt;- arrange(param, param$rmse) # rmse</span></span>
<span id="cb35-7"><a href="monte-carlo-simulation-20-pnts.html#cb35-7" tabindex="-1"></a><span class="co"># q3 &lt;- unlist(param$qsim[1])</span></span>
<span id="cb35-8"><a href="monte-carlo-simulation-20-pnts.html#cb35-8" tabindex="-1"></a><span class="co"># param &lt;- arrange(param, param$mae) # mae</span></span>
<span id="cb35-9"><a href="monte-carlo-simulation-20-pnts.html#cb35-9" tabindex="-1"></a><span class="co"># q4 &lt;- unlist(param$qsim[1])</span></span>
<span id="cb35-10"><a href="monte-carlo-simulation-20-pnts.html#cb35-10" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-11"><a href="monte-carlo-simulation-20-pnts.html#cb35-11" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-12"><a href="monte-carlo-simulation-20-pnts.html#cb35-12" tabindex="-1"></a><span class="co"># # Create dataframe with date and the best runs for each obj function</span></span>
<span id="cb35-13"><a href="monte-carlo-simulation-20-pnts.html#cb35-13" tabindex="-1"></a><span class="co"># PQobjfuns &lt;- tibble(</span></span>
<span id="cb35-14"><a href="monte-carlo-simulation-20-pnts.html#cb35-14" tabindex="-1"></a><span class="co">#   Date = PQ$Date,</span></span>
<span id="cb35-15"><a href="monte-carlo-simulation-20-pnts.html#cb35-15" tabindex="-1"></a><span class="co">#   Qsim_nse = q1,</span></span>
<span id="cb35-16"><a href="monte-carlo-simulation-20-pnts.html#cb35-16" tabindex="-1"></a><span class="co">#   Qsim_kge = q2,</span></span>
<span id="cb35-17"><a href="monte-carlo-simulation-20-pnts.html#cb35-17" tabindex="-1"></a><span class="co">#   Qsim_rmse = q3,</span></span>
<span id="cb35-18"><a href="monte-carlo-simulation-20-pnts.html#cb35-18" tabindex="-1"></a><span class="co">#   Qsim_mae = q4,</span></span>
<span id="cb35-19"><a href="monte-carlo-simulation-20-pnts.html#cb35-19" tabindex="-1"></a><span class="co">#   Qobs = Qobs</span></span>
<span id="cb35-20"><a href="monte-carlo-simulation-20-pnts.html#cb35-20" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb35-21"><a href="monte-carlo-simulation-20-pnts.html#cb35-21" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-22"><a href="monte-carlo-simulation-20-pnts.html#cb35-22" tabindex="-1"></a><span class="co"># # Create a long form tibble</span></span>
<span id="cb35-23"><a href="monte-carlo-simulation-20-pnts.html#cb35-23" tabindex="-1"></a><span class="co"># PQobjfuns_long &lt;- PQobjfuns %&gt;%</span></span>
<span id="cb35-24"><a href="monte-carlo-simulation-20-pnts.html#cb35-24" tabindex="-1"></a><span class="co">#   pivot_longer(names_to = &quot;key&quot;, values_to = &quot;value&quot;, -Date)</span></span>
<span id="cb35-25"><a href="monte-carlo-simulation-20-pnts.html#cb35-25" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-26"><a href="monte-carlo-simulation-20-pnts.html#cb35-26" tabindex="-1"></a><span class="co"># # Plot up the data</span></span>
<span id="cb35-27"><a href="monte-carlo-simulation-20-pnts.html#cb35-27" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-28"><a href="monte-carlo-simulation-20-pnts.html#cb35-28" tabindex="-1"></a><span class="co"># # Plot up the four simulations and label them accordingly in the legend.</span></span>
<span id="cb35-29"><a href="monte-carlo-simulation-20-pnts.html#cb35-29" tabindex="-1"></a><span class="co"># # places the legend inside the plot window in the upper left corner to maximize plot space</span></span>
<span id="cb35-30"><a href="monte-carlo-simulation-20-pnts.html#cb35-30" tabindex="-1"></a><span class="co"># # remember that you can zoom into the plot with plotly</span></span>
<span id="cb35-31"><a href="monte-carlo-simulation-20-pnts.html#cb35-31" tabindex="-1"></a><span class="co"># all_obj_fcts &lt;- ggplot() +</span></span>
<span id="cb35-32"><a href="monte-carlo-simulation-20-pnts.html#cb35-32" tabindex="-1"></a><span class="co">#   geom_line(data = PQobjfuns_long, aes(x = Date, y = value, color = key)) +</span></span>
<span id="cb35-33"><a href="monte-carlo-simulation-20-pnts.html#cb35-33" tabindex="-1"></a><span class="co">#   labs(y = &quot;Discharge (mm/day)&quot;) +</span></span>
<span id="cb35-34"><a href="monte-carlo-simulation-20-pnts.html#cb35-34" tabindex="-1"></a><span class="co">#   scale_color_discrete(</span></span>
<span id="cb35-35"><a href="monte-carlo-simulation-20-pnts.html#cb35-35" tabindex="-1"></a><span class="co">#     name = &quot;Obj. Function&quot;,</span></span>
<span id="cb35-36"><a href="monte-carlo-simulation-20-pnts.html#cb35-36" tabindex="-1"></a><span class="co">#     labels = c(</span></span>
<span id="cb35-37"><a href="monte-carlo-simulation-20-pnts.html#cb35-37" tabindex="-1"></a><span class="co">#       &quot;Observed Runoff&quot;,</span></span>
<span id="cb35-38"><a href="monte-carlo-simulation-20-pnts.html#cb35-38" tabindex="-1"></a><span class="co">#       &quot;Kling-Gupta Efficiency&quot;,</span></span>
<span id="cb35-39"><a href="monte-carlo-simulation-20-pnts.html#cb35-39" tabindex="-1"></a><span class="co">#       &quot;Mean Absolute Error&quot;,</span></span>
<span id="cb35-40"><a href="monte-carlo-simulation-20-pnts.html#cb35-40" tabindex="-1"></a><span class="co">#       &quot;Nash-Sutliffe Efficiency&quot;,</span></span>
<span id="cb35-41"><a href="monte-carlo-simulation-20-pnts.html#cb35-41" tabindex="-1"></a><span class="co">#       &quot;Root Mean Square Error&quot;</span></span>
<span id="cb35-42"><a href="monte-carlo-simulation-20-pnts.html#cb35-42" tabindex="-1"></a><span class="co">#     )</span></span>
<span id="cb35-43"><a href="monte-carlo-simulation-20-pnts.html#cb35-43" tabindex="-1"></a><span class="co">#   ) +</span></span>
<span id="cb35-44"><a href="monte-carlo-simulation-20-pnts.html#cb35-44" tabindex="-1"></a><span class="co">#   theme(legend.position = c(0.2, 0.7)) # places the legend inside the plot window</span></span>
<span id="cb35-45"><a href="monte-carlo-simulation-20-pnts.html#cb35-45" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb35-46"><a href="monte-carlo-simulation-20-pnts.html#cb35-46" tabindex="-1"></a><span class="co"># ggplotly(all_obj_fcts)</span></span></code></pre></div>
<p>Response surface</p>
<div class="sourceCode" id="cb36"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb36-1"><a href="monte-carlo-simulation-20-pnts.html#cb36-1" tabindex="-1"></a><span class="co"># param_surf &lt;- param %&gt;%</span></span>
<span id="cb36-2"><a href="monte-carlo-simulation-20-pnts.html#cb36-2" tabindex="-1"></a><span class="co">#   select(-Run, -qsim) %&gt;%</span></span>
<span id="cb36-3"><a href="monte-carlo-simulation-20-pnts.html#cb36-3" tabindex="-1"></a><span class="co">#   drop_na() %&gt;%</span></span>
<span id="cb36-4"><a href="monte-carlo-simulation-20-pnts.html#cb36-4" tabindex="-1"></a><span class="co">#   filter(nse &gt;= 0)</span></span>
<span id="cb36-5"><a href="monte-carlo-simulation-20-pnts.html#cb36-5" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-6"><a href="monte-carlo-simulation-20-pnts.html#cb36-6" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb36-7"><a href="monte-carlo-simulation-20-pnts.html#cb36-7" tabindex="-1"></a><span class="co">#   geom_density_2d_filled(data = param_surf, aes(x = a, y = b))</span></span>
<span id="cb36-8"><a href="monte-carlo-simulation-20-pnts.html#cb36-8" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb36-9"><a href="monte-carlo-simulation-20-pnts.html#cb36-9" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb36-10"><a href="monte-carlo-simulation-20-pnts.html#cb36-10" tabindex="-1"></a><span class="co">#   geom_contour(data = param_surf, aes(x = a, y = b, z = nse))</span></span></code></pre></div>

</div>
</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="part-2-tabular-models-and-time-series.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="classifying-model-structure---lecture-only-0-pts.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/lekokremer/lres_546_bookdown_lk/edit/main/07_lecture_lab.montecarlo.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/lekokremer/lres_546_bookdown_lk/blob/main/07_lecture_lab.montecarlo.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
