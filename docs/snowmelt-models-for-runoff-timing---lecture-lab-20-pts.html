<!DOCTYPE html>
<html lang="" xml:lang="">
<head>

  <meta charset="utf-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <title>Chapter 9 Snowmelt Models for runoff timing - Lecture &amp; Lab (20 pts) | Quantitative Environmental Methods: LRES 546</title>
  <meta name="description" content="Chapter 9 Snowmelt Models for runoff timing - Lecture &amp; Lab (20 pts) | Quantitative Environmental Methods: LRES 546" />
  <meta name="generator" content="bookdown 0.35 and GitBook 2.6.7" />

  <meta property="og:title" content="Chapter 9 Snowmelt Models for runoff timing - Lecture &amp; Lab (20 pts) | Quantitative Environmental Methods: LRES 546" />
  <meta property="og:type" content="book" />
  
  
  

  <meta name="twitter:card" content="summary" />
  <meta name="twitter:title" content="Chapter 9 Snowmelt Models for runoff timing - Lecture &amp; Lab (20 pts) | Quantitative Environmental Methods: LRES 546" />
  
  
  

<meta name="author" content="Tim Covino &amp; Lauren Kremer" />



  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <meta name="apple-mobile-web-app-capable" content="yes" />
  <meta name="apple-mobile-web-app-status-bar-style" content="black" />
  
  
<link rel="prev" href="classifying-model-structure---lecture-only-0-pts.html"/>
<link rel="next" href="learning-module-10---gridded-and-tabular-data-retrieval.html"/>
<script src="libs/jquery-3.6.0/jquery-3.6.0.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/fuse.js@6.4.6/dist/fuse.min.js"></script>
<link href="libs/gitbook-2.6.7/css/style.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-table.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-bookdown.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-highlight.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-search.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-fontsettings.css" rel="stylesheet" />
<link href="libs/gitbook-2.6.7/css/plugin-clipboard.css" rel="stylesheet" />








<link href="libs/anchor-sections-1.1.0/anchor-sections.css" rel="stylesheet" />
<link href="libs/anchor-sections-1.1.0/anchor-sections-hash.css" rel="stylesheet" />
<script src="libs/anchor-sections-1.1.0/anchor-sections.js"></script>


<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>

<style type="text/css">
  
  div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
</style>

<link rel="stylesheet" href="style.css" type="text/css" />
</head>

<body>



  <div class="book without-animation with-summary font-size-2 font-family-1" data-basepath=".">

    <div class="book-summary">
      <nav role="navigation">

<ul class="summary">
<li><a href="./">lres_546</a></li>

<li class="divider"></li>
<li class="chapter" data-level="1" data-path="index.html"><a href="index.html"><i class="fa fa-check"></i><b>1</b> Introduction</a>
<ul>
<li class="chapter" data-level="1.1" data-path="index.html"><a href="index.html#course-overview-and-objectives"><i class="fa fa-check"></i><b>1.1</b> Course overview and objectives</a></li>
<li class="chapter" data-level="1.2" data-path="index.html"><a href="index.html#course-description"><i class="fa fa-check"></i><b>1.2</b> Course Description</a></li>
<li class="chapter" data-level="1.3" data-path="index.html"><a href="index.html#structure"><i class="fa fa-check"></i><b>1.3</b> Structure</a></li>
<li class="chapter" data-level="1.4" data-path="index.html"><a href="index.html#philosophical-approach-and-resources"><i class="fa fa-check"></i><b>1.4</b> Philosophical approach and resources</a></li>
<li class="chapter" data-level="1.5" data-path="index.html"><a href="index.html#tentative-schedule-subject-to-change"><i class="fa fa-check"></i><b>1.5</b> Tentative schedule, subject to change</a></li>
</ul></li>
<li class="chapter" data-level="2" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html"><i class="fa fa-check"></i><b>2</b> Hydrograph separation: learning module</a>
<ul>
<li class="chapter" data-level="2.1" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#summary"><i class="fa fa-check"></i><b>2.1</b> Summary</a></li>
<li class="chapter" data-level="2.2" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#overall-learning-objectives"><i class="fa fa-check"></i><b>2.2</b> Overall Learning Objectives</a></li>
<li class="chapter" data-level="2.3" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#lecture"><i class="fa fa-check"></i><b>2.3</b> Lecture</a>
<ul>
<li class="chapter" data-level="2.3.1" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#components-of-streamflow-during-a-rain-event"><i class="fa fa-check"></i><b>2.3.1</b> Components of streamflow during a rain event</a></li>
<li class="chapter" data-level="2.3.2" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#storm-flow-through-a-hillslope"><i class="fa fa-check"></i><b>2.3.2</b> Storm flow through a hillslope</a></li>
<li class="chapter" data-level="2.3.3" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#how-we-quantify-baseflow"><i class="fa fa-check"></i><b>2.3.3</b> How we quantify baseflow</a></li>
<li class="chapter" data-level="2.3.4" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#baseflow-separation-methods"><i class="fa fa-check"></i><b>2.3.4</b> Baseflow separation methods</a></li>
<li class="chapter" data-level="2.3.5" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#watershed-controls-on-baseflow-and-stormflow"><i class="fa fa-check"></i><b>2.3.5</b> Watershed controls on baseflow and stormflow</a></li>
</ul></li>
<li class="chapter" data-level="2.4" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#assessment"><i class="fa fa-check"></i><b>2.4</b> Assessment</a></li>
<li class="chapter" data-level="2.5" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#interactive-application-and-questions"><i class="fa fa-check"></i><b>2.5</b> Interactive application and questions</a>
<ul>
<li class="chapter" data-level="2.5.1" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#initial-data-exploration"><i class="fa fa-check"></i><b>2.5.1</b> Initial data exploration</a></li>
<li class="chapter" data-level="2.5.2" data-path="hydrograph-separation-learning-module.html"><a href="hydrograph-separation-learning-module.html#synthesis-questions"><i class="fa fa-check"></i><b>2.5.2</b> Synthesis Questions</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="3" data-path="hydrograph-separation-lab-module-20-pts.html"><a href="hydrograph-separation-lab-module-20-pts.html"><i class="fa fa-check"></i><b>3</b> Hydrograph separation: lab module (20 pts)</a>
<ul>
<li class="chapter" data-level="3.1" data-path="hydrograph-separation-lab-module-20-pts.html"><a href="hydrograph-separation-lab-module-20-pts.html#intro"><i class="fa fa-check"></i><b>3.1</b> Intro</a></li>
<li class="chapter" data-level="3.2" data-path="hydrograph-separation-lab-module-20-pts.html"><a href="hydrograph-separation-lab-module-20-pts.html#reading-for-this-lab"><i class="fa fa-check"></i><b>3.2</b> Reading for this lab</a></li>
<li class="chapter" data-level="3.3" data-path="hydrograph-separation-lab-module-20-pts.html"><a href="hydrograph-separation-lab-module-20-pts.html#repo"><i class="fa fa-check"></i><b>3.3</b> Repo</a></li>
</ul></li>
<li class="chapter" data-level="4" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html"><i class="fa fa-check"></i><b>4</b> Learning module 2 - Return intervals (14 pts)</a>
<ul>
<li class="chapter" data-level="4.1" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#background-information"><i class="fa fa-check"></i><b>4.1</b> Background information</a></li>
<li class="chapter" data-level="4.2" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#intro-1"><i class="fa fa-check"></i><b>4.2</b> Intro</a></li>
<li class="chapter" data-level="4.3" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#packages"><i class="fa fa-check"></i><b>4.3</b> Packages</a></li>
<li class="chapter" data-level="4.4" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#precipitation-return-intervals"><i class="fa fa-check"></i><b>4.4</b> Precipitation return intervals</a>
<ul>
<li class="chapter" data-level="4.4.1" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#q1.-2-pts-what-is-the-probability-that-the-annual-precipitation-in-a-given-year-is-less-than-400-mm-this-is-the-fa-in-the-cdf-in-the-probability-lecture-slides."><i class="fa fa-check"></i><b>4.4.1</b> <strong>Q1. (2 pts) What is the probability that the annual precipitation in a given year is less than 400 mm? This is the F(A) in the CDF in the probability lecture slides.</strong></a></li>
<li class="chapter" data-level="4.4.2" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#q2.-2-pts-what-is-the-probability-that-the-maximum-annual-precipitation-in-a-given-year-is-greater-than-500-mm"><i class="fa fa-check"></i><b>4.4.2</b> <strong>Q2. (2 pts) What is the probability that the maximum annual precipitation in a given year is GREATER than 500 mm?</strong></a></li>
<li class="chapter" data-level="4.4.3" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#q3.-2-pts-what-is-the-probability-that-the-annual-p-is-between-400-and-500-mm"><i class="fa fa-check"></i><b>4.4.3</b> <strong>Q3. (2 pts) What is the probability that the annual P is between 400 and 500 mm?</strong></a></li>
<li class="chapter" data-level="4.4.4" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#q4.-2-pts-what-is-the-return-period-for-a-year-with-at-least-550-mm-of-precip-the-return-period-tr-is-calculated-as-tr-1p-with-p-being-the-probability-for-an-event-to-occur."><i class="fa fa-check"></i><b>4.4.4</b> <strong>Q4. (2 pts) What is the return period for a year with AT LEAST 550 mm of precip? The return period, Tr, is calculated as Tr = 1/p, with p being the probability for an event to occur.</strong></a></li>
<li class="chapter" data-level="4.4.5" data-path="learning-module-2---return-intervals-14-pts.html"><a href="learning-module-2---return-intervals-14-pts.html#q5.-6-pts-explain-why-probability-analysis-of-climate-data-assumes-the-data-are-normally-distributed-and-stationary-below-provide-a-histogram-and-a-density-plot-of-the-total-annual-p-data-and-comment-on-the-visual-appearance-in-terms-of-normality.-next-use-google-and-the-links-below-to-test-for-normality-and-stationarity.-be-quantitative-in-commenting-on-the-normality-and-stationarity-of-the-total-p-data."><i class="fa fa-check"></i><b>4.4.5</b> <strong>Q5. (6 pts) Explain why probability analysis of climate data assumes the data are normally distributed and stationary? Below provide a histogram and a density plot of the total annual P data and comment on the visual appearance in terms of normality. Next use google and the links below to test for normality and stationarity. Be quantitative in commenting on the normality and stationarity of the total P data.</strong></a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="5" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html"><i class="fa fa-check"></i><b>5</b> Rational method and NRCS curve number (20 pts)</a>
<ul>
<li class="chapter" data-level="5.1" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html#rational-method"><i class="fa fa-check"></i><b>5.1</b> Rational Method</a>
<ul>
<li class="chapter" data-level="5.1.1" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html#background-information-1"><i class="fa fa-check"></i><b>5.1.1</b> Background information</a></li>
</ul></li>
<li class="chapter" data-level="5.2" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html#curve-number"><i class="fa fa-check"></i><b>5.2</b> Curve Number</a>
<ul>
<li class="chapter" data-level="5.2.1" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html#background-information-2"><i class="fa fa-check"></i><b>5.2.1</b> Background information</a></li>
</ul></li>
<li class="chapter" data-level="5.3" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html#codework"><i class="fa fa-check"></i><b>5.3</b> Codework</a>
<ul>
<li class="chapter" data-level="5.3.1" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html#packages-1"><i class="fa fa-check"></i><b>5.3.1</b> Packages</a></li>
<li class="chapter" data-level="5.3.2" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html#part-i---rational-method"><i class="fa fa-check"></i><b>5.3.2</b> Part I - Rational Method</a></li>
<li class="chapter" data-level="5.3.3" data-path="rational-method-and-nrcs-curve-number-20-pts.html"><a href="rational-method-and-nrcs-curve-number-20-pts.html#part-ii---nrcs-cn"><i class="fa fa-check"></i><b>5.3.3</b> Part II - NRCS CN</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="6" data-path="transfer-function-rainfall-runoff-models.html"><a href="transfer-function-rainfall-runoff-models.html"><i class="fa fa-check"></i><b>6</b> Transfer function rainfall-runoff models</a>
<ul>
<li class="chapter" data-level="6.1" data-path="transfer-function-rainfall-runoff-models.html"><a href="transfer-function-rainfall-runoff-models.html#summary-1"><i class="fa fa-check"></i><b>6.1</b> Summary</a></li>
<li class="chapter" data-level="6.2" data-path="transfer-function-rainfall-runoff-models.html"><a href="transfer-function-rainfall-runoff-models.html#overall-learning-objectives-1"><i class="fa fa-check"></i><b>6.2</b> Overall Learning Objectives</a></li>
<li class="chapter" data-level="6.3" data-path="transfer-function-rainfall-runoff-models.html"><a href="transfer-function-rainfall-runoff-models.html#terminology"><i class="fa fa-check"></i><b>6.3</b> Terminology</a></li>
<li class="chapter" data-level="6.4" data-path="transfer-function-rainfall-runoff-models.html"><a href="transfer-function-rainfall-runoff-models.html#the-linear-time-invariant-tf"><i class="fa fa-check"></i><b>6.4</b> The Linear Time-Invariant TF</a></li>
<li class="chapter" data-level="6.5" data-path="transfer-function-rainfall-runoff-models.html"><a href="transfer-function-rainfall-runoff-models.html#codework---transfer-function-rainfall-runoff-model"><i class="fa fa-check"></i><b>6.5</b> Codework - Transfer function rainfall-runoff model</a>
<ul>
<li class="chapter" data-level="6.5.1" data-path="transfer-function-rainfall-runoff-models.html"><a href="transfer-function-rainfall-runoff-models.html#download-the-repo-for-this-lab-here"><i class="fa fa-check"></i><b>6.5.1</b> Download the repo for this lab HERE</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="7" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html"><i class="fa fa-check"></i><b>7</b> Monte Carlo Simulation (20 pnts)</a>
<ul>
<li class="chapter" data-level="7.1" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#background"><i class="fa fa-check"></i><b>7.1</b> Background:</a>
<ul>
<li class="chapter" data-level="7.1.1" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#reading"><i class="fa fa-check"></i><b>7.1.1</b> Reading</a></li>
</ul></li>
<li class="chapter" data-level="7.2" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#how-does-this-apply-to-hydrological-modeling"><i class="fa fa-check"></i><b>7.2</b> How does this apply to hydrological modeling?</a>
<ul>
<li class="chapter" data-level="7.2.1" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#example"><i class="fa fa-check"></i><b>7.2.1</b> Example</a></li>
<li class="chapter" data-level="7.2.2" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#reading-1"><i class="fa fa-check"></i><b>7.2.2</b> Reading</a></li>
</ul></li>
<li class="chapter" data-level="7.3" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#how-do-we-generate-a-simulation-with-code"><i class="fa fa-check"></i><b>7.3</b> How do we generate a simulation with code?</a></li>
<li class="chapter" data-level="7.4" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#codework-1"><i class="fa fa-check"></i><b>7.4</b> Codework</a>
<ul>
<li class="chapter" data-level="7.4.1" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#download-the-repo-for-this-lab-here-1"><i class="fa fa-check"></i><b>7.4.1</b> Download the repo for this lab HERE</a></li>
<li class="chapter" data-level="7.4.2" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#setup"><i class="fa fa-check"></i><b>7.4.2</b> Setup</a></li>
<li class="chapter" data-level="7.4.3" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#parameter-initialization"><i class="fa fa-check"></i><b>7.4.3</b> Parameter initialization</a></li>
<li class="chapter" data-level="7.4.4" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#mc-model-run"><i class="fa fa-check"></i><b>7.4.4</b> MC Model run</a></li>
<li class="chapter" data-level="7.4.5" data-path="monte-carlo-simulation-20-pnts.html"><a href="monte-carlo-simulation-20-pnts.html#sensitivity-analysis"><i class="fa fa-check"></i><b>7.4.5</b> Sensitivity analysis</a></li>
</ul></li>
</ul></li>
<li class="chapter" data-level="8" data-path="classifying-model-structure---lecture-only-0-pts.html"><a href="classifying-model-structure---lecture-only-0-pts.html"><i class="fa fa-check"></i><b>8</b> Classifying model structure - Lecture only (0 pts)</a>
<ul>
<li class="chapter" data-level="8.1" data-path="classifying-model-structure---lecture-only-0-pts.html"><a href="classifying-model-structure---lecture-only-0-pts.html#spatial-complexity"><i class="fa fa-check"></i><b>8.1</b> Spatial Complexity</a></li>
<li class="chapter" data-level="8.2" data-path="classifying-model-structure---lecture-only-0-pts.html"><a href="classifying-model-structure---lecture-only-0-pts.html#modeling-approaches"><i class="fa fa-check"></i><b>8.2</b> Modeling Approaches</a></li>
</ul></li>
<li class="chapter" data-level="9" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><i class="fa fa-check"></i><b>9</b> Snowmelt Models for runoff timing - Lecture &amp; Lab (20 pts)</a>
<ul>
<li class="chapter" data-level="9.1" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#module-repo"><i class="fa fa-check"></i><b>9.1</b> Module repo</a></li>
<li class="chapter" data-level="9.2" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#background-1"><i class="fa fa-check"></i><b>9.2</b> Background:</a></li>
<li class="chapter" data-level="9.3" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#model-approaches"><i class="fa fa-check"></i><b>9.3</b> Model Approaches</a></li>
<li class="chapter" data-level="9.4" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#spatial-complexity-1"><i class="fa fa-check"></i><b>9.4</b> Spatial complexity</a></li>
<li class="chapter" data-level="9.5" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#model-choices-my-snow-is-different-from-your-snow"><i class="fa fa-check"></i><b>9.5</b> Model choices: My snow is different from your snow</a></li>
<li class="chapter" data-level="9.6" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#codework-2"><i class="fa fa-check"></i><b>9.6</b> Codework</a>
<ul>
<li class="chapter" data-level="9.6.1" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#download-the-repo-for-this-lab-here-2"><i class="fa fa-check"></i><b>9.6.1</b> Download the repo for this lab HERE</a></li>
<li class="chapter" data-level="9.6.2" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#import-data"><i class="fa fa-check"></i><b>9.6.2</b> Import data:</a></li>
<li class="chapter" data-level="9.6.3" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#calculate-liquid-input"><i class="fa fa-check"></i><b>9.6.3</b> Calculate liquid input</a></li>
</ul></li>
<li class="chapter" data-level="9.7" data-path="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#modeling-swe"><i class="fa fa-check"></i><b>9.7</b> Modeling SWE</a></li>
</ul></li>
<li class="chapter" data-level="10" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html"><i class="fa fa-check"></i><b>10</b> Learning Module 10 - Gridded and tabular data retrieval</a>
<ul>
<li class="chapter" data-level="10.1" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#objectives"><i class="fa fa-check"></i><b>10.1</b> Objectives</a></li>
<li class="chapter" data-level="10.2" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#background-2"><i class="fa fa-check"></i><b>10.2</b> Background</a>
<ul>
<li class="chapter" data-level="10.2.1" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#a-refresher-in-gis-concepts"><i class="fa fa-check"></i><b>10.2.1</b> A refresher in GIS concepts:</a></li>
<li class="chapter" data-level="10.2.2" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#a-refresher-in-remote-sensing"><i class="fa fa-check"></i><b>10.2.2</b> A refresher in remote sensing:</a></li>
<li class="chapter" data-level="10.2.3" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#ethical-conduct"><i class="fa fa-check"></i><b>10.2.3</b> Ethical conduct</a></li>
</ul></li>
<li class="chapter" data-level="10.3" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#codework-3"><i class="fa fa-check"></i><b>10.3</b> Codework</a>
<ul>
<li class="chapter" data-level="10.3.1" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#setup-1"><i class="fa fa-check"></i><b>10.3.1</b> Setup:<br></a></li>
<li class="chapter" data-level="10.3.2" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#selecting-a-watershed"><i class="fa fa-check"></i><b>10.3.2</b> Selecting a watershed:</a></li>
<li class="chapter" data-level="10.3.3" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#flow-data-retrieval"><i class="fa fa-check"></i><b>10.3.3</b> Flow data retrieval:</a></li>
<li class="chapter" data-level="10.3.4" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#watershed-boundary-vector-data"><i class="fa fa-check"></i><b>10.3.4</b> Watershed boundary vector data:</a></li>
<li class="chapter" data-level="10.3.5" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#digital-elevation-models-dem"><i class="fa fa-check"></i><b>10.3.5</b> Digital Elevation Models (DEM)</a></li>
<li class="chapter" data-level="10.3.6" data-path="learning-module-10---gridded-and-tabular-data-retrieval.html"><a href="learning-module-10---gridded-and-tabular-data-retrieval.html#other-remotely-sensed-data"><i class="fa fa-check"></i><b>10.3.6</b> Other remotely sensed data:</a></li>
</ul></li>
</ul></li>
<li class="divider"></li>
<li><a href="https://github.com/rstudio/bookdown" target="blank">Published with bookdown</a></li>
</ul>

      </nav>
    </div>

    <div class="book-body">
      <div class="body-inner">
        <div class="book-header" role="navigation">
          <h1>
            <i class="fa fa-circle-o-notch fa-spin"></i><a href="./">Quantitative Environmental Methods: LRES 546</a>
          </h1>
        </div>

        <div class="page-wrapper" tabindex="-1" role="main">
          <div class="page-inner">

            <section class="normal" id="section-">
<div id="snowmelt-models-for-runoff-timing---lecture-lab-20-pts" class="section level1 hasAnchor" number="9">
<h1><span class="header-section-number">Chapter 9</span> Snowmelt Models for runoff timing - Lecture &amp; Lab (20 pts)<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#snowmelt-models-for-runoff-timing---lecture-lab-20-pts" class="anchor-section" aria-label="Anchor link to header"></a></h1>
<div id="module-repo" class="section level2 hasAnchor" number="9.1">
<h2><span class="header-section-number">9.1</span> <a href="https://github.com/tpcovino/06_snowmelt_models.git" target="_blank">Module repo</a><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#module-repo" class="anchor-section" aria-label="Anchor link to header"></a></h2>
</div>
<div id="background-1" class="section level2 hasAnchor" number="9.2">
<h2><span class="header-section-number">9.2</span> Background:<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#background-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Understanding snowmelt runoff is crucial for managing water resources and assessing flood risks, as it plays a significant role in the hydrologic cycle. Annual runoff and peak flow are influenced by snowmelt, rainfall, or a combination of both. In regions with a snowmelt-driven hydrologic cycle, such as the Rocky Mountains, snowpack acts as a natural reservoir, storing water during the winter months and releasing it gradually during the spring and early summer, thereby playing a vital role in maintaining water availability for various uses downstream. By examining how snowmelt interacts with other factors like precipitation, land cover, and temperature, we can better anticipate water supply fluctuations and design effective flood management strategies.</p>
<p>Learning objectives:</p>
<p>In this module, our primary focus will be modeling snowmelt as runoff, enabling us to predict when it will impact streamflow timing. We will consider some factors that may influence runoff timing. However, the term ‘snowmelt modeling’ is a field in itself and can represent a lifetime worth of work. There are many uses for snowmelt modeling (e.g., climate science and avalanche forecasting). If you are interested in exploring more on this subject, there is an excellent Snow Hydrology: Focus on Modeling series offered by <a href="https://www.cuahsi.org" target="_blank">CUAHSI’s</a> Virtual University on YouTube.</p>
<p>Helpful terms:</p>
<p>The most common way to measure the water content of the snowpack is by the Snow Water Equivalent or <strong>SWE</strong>. The SWE is the water depth resulting from melting a unit column of the snowpack.</p>
</div>
<div id="model-approaches" class="section level2 hasAnchor" number="9.3">
<h2><span class="header-section-number">9.3</span> Model Approaches<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#model-approaches" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Similar to the model development structure we discussed in the last module, snowmelt models are generally classified into three different types of <a href="https://nsidc.org/learn/cryosphere-glossary/ablation#:~:text=Ice%20Data%20Center-,ablation,melting%2C%20evaporation%2C%20wind%20and%20avalanches" target="_blank">abalation</a> algorithms</p>
<p><strong>Empirical and Data-Driven Models:</strong>
These models use historical data and statistical techniques to predict runoff based on the relationship between snow characteristics (like snow area) and runoff. They use past patterns to make predictions about the future. The emergence of data-driven models has benefited from the growth of massive data and the rapid increase in computational power. These models simulate the changes in snowmelt runoff using machine learning algorithms to select appropriate parameters (e.g., daily rainfall, temperature, solar radiation, snow area, and snow water equivalent) from different data sources.</p>
<p><strong>Conceptual Models:</strong>
These models simplify the snowmelt process by establishing a simple, rule-based relationship between snowmelt and temperature. These models use a basic formula based on temperature to estimate how much snow will melt.</p>
<p><strong>Physical Models:</strong>
The physical snowmelt models calculate snowmelt based on the energy balance of snow cover. If all the heat fluxes toward the snowpack are considered positive and those away are considered negative, the sum of these fluxes is equal to the change in heat content of the snowpack for a given time period. Fluxes considered may be</p>
<ul>
<li>net solar radiation (solar incoming minus albedo),</li>
<li>thermal radiation,</li>
<li>sensible heat transfer of air (e.g., when air is a different temperature than snowpack),</li>
<li>latent heat of vaporization from condensation or evaporation/sublimation,
heat conducted from the ground,</li>
<li>advected heat from precipitation</li>
</ul>
<p>examples: layered snow thermal model (SNTHERM) and physical snowpack model (SNOWPACK),</p>
<p>Many effective models may incorporate elements from some or all of these modeling approaches.</p>
</div>
<div id="spatial-complexity-1" class="section level2 hasAnchor" number="9.4">
<h2><span class="header-section-number">9.4</span> Spatial complexity<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#spatial-complexity-1" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>We may also identify models based on the model architecture or spatial complexity. The architecture can be designed based on assumptions about the physical processes that may affect the snowmelt to runoff volume and timing.</p>
<p><strong>Homogenous basin modeling:</strong> You may also hear these types of models referred to as ‘black box’ models. Black-box models do not provide a detailed description of the underlying hydrological processes. Instead, they are typically expressed as empirical models that rely on statistical relationships between input and output variables. While these models can predict specific outcomes effectively, they may not be ideal for understanding the physical mechanisms that drive hydrological processes. In terms of snow cover, this is a simplistic case model where we assume:</p>
<ul>
<li>the snow is consistent from top to bottom of the snow column and across the watershed</li>
<li>melt appears at the top of the snowpack</li>
<li>water immediately flows out the bottom</li>
</ul>
<p>This type of modeling may work well if the snowpack is isothermal, if we are interested in runoff over large timesteps, or if we are modeling annual water budgets in lumped models.</p>
<p><strong>Vertical layered modeling:</strong> Depending on the desired application of the model, snowmelt may be modeled in multiple layers in the snow column (air-snow surface to ground). Climate models, for example, may estimate phase changes or heat flux and consider the snowpack in 5 or more layers. Avalanche forecasters may need to consider grain evolution, density, water content, and more over hundreds of layers! Hydrologists may also choose variable layers, but many will choose single- or two-layer models for basin-wide studies, as simple models can be effective when estimating basin runoff. <a href="https://journals.ametsoc.org/view/journals/hydr/13/2/jhm-d-11-072_1.xml">Here</a> is a study by Dutra et al. (2012) that looked at the effect of the number of snow layers, liquid water representation, snow density, and snow albedo parameterizations within their tested models. Table 1 and figures 1-3 will be sufficient to understand the effects of changes to these parameters on modeled runoff and SWE. In this case, the three-layer model performed best when predicting the timing of the SWE and runoff, but density improved more by changing other parameters rather than layers (Figure 1).</p>
<p><strong>Lateral spatial heterogeneity:</strong>
The spatial extent of the snow cover determines the area contributing to runoff at any given time during the melt period. The more snow there is, the more water there will be when it melts. Therefore, snow cover tells us which areas will contribute water to rivers and streams as the snow melts.
In areas with a lot of accumulated snow, the amount of snow covering the ground gradually decreases as the weather warms up. This melting process can take several months. How quickly the snow disappears depends on the landscape. For example, in mountainous ecosystems, factors like elevation, slope aspect, slope gradient, and <a href="https://repository.library.noaa.gov/view/noaa/45144" target="_blank">forest structure</a> affect how the snow can accumulate, evaporate or sublimate and how quickly the snow melts.</p>
<p>For mountain areas, similar patterns of depletion occur from year to year and can be related to the snow water equivalent (SWE) at a site, accumulated ablation, accumulated degree-days, or to runoff from the watershed using depletion curves from historical data. <a href="https://www.mdpi.com/2076-3263/8/12/484#:~:text=Snow%20depletion%20curves%20(SDC)%20are,snow%20depth%20or%20water%20equivalent" target="_blank">Here</a> is an example of snow depletion curves developed using statistical modeling and remotely sensed data. The use of remotely sensed data can be incredibly helpful to providing estimates in remote areas with infrequent measurements.
Observing depletion patterns may not be effective in ecosystems where patterns are more variable (e.g., prairies). However, stratified sampling with snow surveys, snow telemetry networks (SNOTEL) or continuous precipitation measurements can be used with techniques like <a href="https://hess.copernicus.org/articles/27/3525/2023/" target="&quot;_blank">cluster analyses</a> or interpolation, to determine variables that influence SWE and estimate SWE depth or runoff over heterogeneous systems.</p>
<p>You can further explore all readings linked in the above section. These readings may assist in developing the workflow for your term project, though they are optional for completing this assignment. However, it is recommended that you review the figures to grasp the concepts and retain them for future reference if necessary.</p>
</div>
<div id="model-choices-my-snow-is-different-from-your-snow" class="section level2 hasAnchor" number="9.5">
<h2><span class="header-section-number">9.5</span> Model choices: My snow is different from your snow<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#model-choices-my-snow-is-different-from-your-snow" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>When determining the architecture of your snow model, your model choices will reflect the application of your model and the processes you are trying to represent. Recall that parsimony and simplicity often make for the most effective models. So, how do we know if we have a good model? Here are a few things we can check to validate our model choices:</p>
<p><strong>Model Variability:</strong> A good model should produce consistent results when given the same inputs and conditions. Variability between model runs should be minimal if the watershed or environment is not changing.</p>
<p><strong>Versatility:</strong> Check the model under a range of scenarios different from the conditions under which it was developed. The model should apply to similar systems or scenarios beyond the initial scope of development</p>
<p><strong>Sensitivity Analysis:</strong> We reviewed this a bit in the Monte Carlo module. How do changes in model inputs impact outputs? A good model will show reasonable sensitivity changes in input parameters, with outputs responding as expected.</p>
<p><strong>Validation with empirical data:</strong> Comparison with real-world data checks whether the model accurately represents the actual system</p>
<p><strong>Applicability and simplicity:</strong> A good model should provide valuable insights or aid in decision-making processes relevant to the problem it addresses. It strikes a balance between complexity and simplicity, avoiding unnecessary intricacies that can lead to overfitting or computational inefficiency while sufficiently capturing the system’s complexities.</p>
</div>
<div id="codework-2" class="section level2 hasAnchor" number="9.6">
<h2><span class="header-section-number">9.6</span> Codework<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#codework-2" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<div id="download-the-repo-for-this-lab-here-2" class="section level3 hasAnchor" number="9.6.1">
<h3><span class="header-section-number">9.6.1</span> <a href="https://github.com/tpcovino/06_snowmelt_models.git" target="_blank">Download the repo for this lab HERE</a><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#download-the-repo-for-this-lab-here-2" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>In this module, we will simulate snowmelt in a montane watershed in central Colorado with a simple temperature model. The Fool Creek watershed is located in the Fraser Experimental Forest (FEF), 137 km west of Denver, Colorado. The FEF contains several headwater streams (Strahler order 1-3) within the Colorado Headwaters watershed which supplies much of the water to the populated Colorado Front Range. This Forest has been the site of many studies to evaluate the effects of land cover change on watershed hydrology. The Fool Creek is a small, forested headwater stream, with an approximate watershed area of 2.75 km^2. The watershed elevation ranges from approximately 2,930m (9,600ft) at the USFS monitoring station to 3,475m (11,400ft) at the highest point. There is a SNOTEL station located at 3,400m.</p>
<div class="float">
<img src="images/fool_studyarea.png" alt="Fool Creek delineated watershed" />
<div class="figcaption">Fool Creek delineated watershed</div>
</div>
<p>Question 1: Using this map, what differences can you see between these two sites or what variation do you see in the watershed that may affect snow accumulation and melt? (2 points)?</p>
<p>ANSWER:</p>
<p>Let’s look at some data for Fool Creek:</p>
<p>This script collects <a href="https://www.nrcs.usda.gov/wps/portal/wcc/home/aboutUs/monitoringPrograms/automatedSnowMonitoring/" target="_blank">SNOTEL</a> input data using snotelr. The SNOTEL automated collection site in Fool Creek supplies SWE data that can simplify our runoff modeling. Lets explore the sites available through snotelr and select the site of interest.</p>
<div class="sourceCode" id="cb51"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb51-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb51-1" tabindex="-1"></a><span class="co"># Save metadata for review. </span></span>
<span id="cb51-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb51-2" tabindex="-1"></a><span class="co"># meta_data &lt;- snotel_info()</span></span>
<span id="cb51-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb51-3" tabindex="-1"></a></span>
<span id="cb51-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb51-4" tabindex="-1"></a><span class="co"># In the view window, you can find Fool Creek site information by sorting by state or site name using the arrows at the top of each column. </span></span>
<span id="cb51-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb51-5" tabindex="-1"></a><span class="co"># View(meta_data) # Locate the site_id for Fool Creek</span></span></code></pre></div>
</div>
<div id="import-data" class="section level3 hasAnchor" number="9.6.2">
<h3><span class="header-section-number">9.6.2</span> Import data:<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#import-data" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>We will generate a conceptual runoff model using the date, daily mean temperature, SWE depth in mm, and daily precipitation (mm). We will use select() to keep the desired columns only. Then we will use mutate() to add a water year, and group_by() to add a cumulative precipitation column for each water year.</p>
<div class="sourceCode" id="cb52"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb52-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-1" tabindex="-1"></a><span class="co"># # Let&#39;s download data for the water years 2021 to 2022:</span></span>
<span id="cb52-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-2" tabindex="-1"></a><span class="co"># df &lt;- snotel_download(site_id = 1186, internal = TRUE) %&gt;%</span></span>
<span id="cb52-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-3" tabindex="-1"></a><span class="co">#     mutate(date = lubridate::ymd(date)) %&gt;% # format the date</span></span>
<span id="cb52-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-4" tabindex="-1"></a><span class="co">#     filter(between(date, lubridate::ymd(&quot;2020-10-01&quot;), lubridate::ymd(&quot;2022-09-30&quot;))) %&gt;% # select desired dates</span></span>
<span id="cb52-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-5" tabindex="-1"></a><span class="co">#     rename(swe.mm = snow_water_equivalent, # rename columns for easier use</span></span>
<span id="cb52-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-6" tabindex="-1"></a><span class="co">#          precip.mm  = precipitation,</span></span>
<span id="cb52-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-7" tabindex="-1"></a><span class="co">#          temp_mean.c = temperature_mean) %&gt;%</span></span>
<span id="cb52-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-8" tabindex="-1"></a><span class="co">#     # only select data we need</span></span>
<span id="cb52-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-9" tabindex="-1"></a><span class="co">#     select(date, swe.mm, precip.mm, temp_mean.c) %&gt;%</span></span>
<span id="cb52-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-10" tabindex="-1"></a><span class="co">#     mutate(wtr_yr = if_else(month(date) &lt; 10, year(date), year(date) + 1)) %&gt;%</span></span>
<span id="cb52-11"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-11" tabindex="-1"></a><span class="co">#     group_by(wtr_yr) %&gt;% # add a water year column</span></span>
<span id="cb52-12"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-12" tabindex="-1"></a><span class="co">#     mutate(pcumul.mm = cumsum(precip.mm)) %&gt;% # generate a cumulative sum column for each water year</span></span>
<span id="cb52-13"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb52-13" tabindex="-1"></a><span class="co">#     ungroup()</span></span></code></pre></div>
<p>We will also download flow data collected by USFS at the Fool Creek outlet at 2,930m.</p>
<div class="sourceCode" id="cb53"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb53-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb53-1" tabindex="-1"></a><span class="co"># fool_q &lt;- read.csv(&quot;LFC_weir WY21-WY22.csv&quot;) %&gt;%</span></span>
<span id="cb53-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb53-2" tabindex="-1"></a><span class="co">#   mutate(date = mdy_hm(TIMESTAMP)) %&gt;%</span></span>
<span id="cb53-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb53-3" tabindex="-1"></a><span class="co">#   # convert cubic feet per second to metric (m/s^3)</span></span>
<span id="cb53-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb53-4" tabindex="-1"></a><span class="co">#   # 1 cfs is equal to 0.028316847 cubic meter/second</span></span>
<span id="cb53-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb53-5" tabindex="-1"></a><span class="co">#   mutate(m3_s = Q..cfs.*0.028316847)</span></span></code></pre></div>
<p>Let’s look at the data for the SNOTEL station at 3400m in elevation.</p>
<div class="sourceCode" id="cb54"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb54-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-1" tabindex="-1"></a><span class="co"># Plot imported SWE, precip and depth data data</span></span>
<span id="cb54-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-2" tabindex="-1"></a><span class="co"># ggplot(data = df) +</span></span>
<span id="cb54-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-3" tabindex="-1"></a><span class="co">#   geom_line(aes(x = date, y = swe.mm, color = &#39;swe.mm&#39;)) +</span></span>
<span id="cb54-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-4" tabindex="-1"></a><span class="co">#   geom_line(aes(x = date, y = pcumul.mm, color = &#39;pcumul.mm&#39;)) +</span></span>
<span id="cb54-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-5" tabindex="-1"></a><span class="co">#   geom_line(aes(x=date, y = precip.mm, color = &#39;precip.mm&#39;)) +</span></span>
<span id="cb54-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-6" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels by 45 degrees</span></span>
<span id="cb54-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-7" tabindex="-1"></a><span class="co">#         axis.line = element_line(color = &quot;black&quot;),  # Add black axis lines</span></span>
<span id="cb54-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-8" tabindex="-1"></a><span class="co">#         panel.background = element_rect(fill = &quot;white&quot;),  # Set panel background to white</span></span>
<span id="cb54-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-9" tabindex="-1"></a><span class="co">#         panel.grid.major = element_blank(),  # Remove major grid lines</span></span>
<span id="cb54-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-10" tabindex="-1"></a><span class="co">#         panel.grid.minor = element_blank()) + # Remove minor grid lines</span></span>
<span id="cb54-11"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-11" tabindex="-1"></a><span class="co">#   ylab(&quot;mm&quot;) +</span></span>
<span id="cb54-12"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb54-12" tabindex="-1"></a><span class="co">#   xlab(&#39;Date&#39;) </span></span></code></pre></div>
</div>
<div id="calculate-liquid-input" class="section level3 hasAnchor" number="9.6.3">
<h3><span class="header-section-number">9.6.3</span> Calculate liquid input<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#calculate-liquid-input" class="anchor-section" aria-label="Anchor link to header"></a></h3>
<p>to the ground by analyzing the daily changes in Snow Water Equivalent (SWE) and precipitation. This script incorporates temperature conditions to determine when to add changes to liquid input.</p>
<div class="sourceCode" id="cb55"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb55-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-1" tabindex="-1"></a><span class="co"># sntl &lt;- df </span></span>
<span id="cb55-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-2" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb55-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-3" tabindex="-1"></a><span class="co"># sntl &lt;- sntl %&gt;%</span></span>
<span id="cb55-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-4" tabindex="-1"></a><span class="co">#   # calculate differences for SWE and cumulative P and put 0 as the first value</span></span>
<span id="cb55-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-5" tabindex="-1"></a><span class="co">#   mutate(SWEdiff.mm = c(0, diff(sntl$swe.mm, lag = 1)), #find daily change in SWE</span></span>
<span id="cb55-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-6" tabindex="-1"></a><span class="co">#         Pdiff.mm = c(0, diff(pcumul.mm, lag = 1))) %&gt;%</span></span>
<span id="cb55-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-7" tabindex="-1"></a><span class="co">#   # remove the negative values at the start of each year</span></span>
<span id="cb55-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-8" tabindex="-1"></a><span class="co">#   mutate(Pdiff.mm = if_else(Pdiff.mm &lt; 0, 0, Pdiff.mm)) %&gt;%</span></span>
<span id="cb55-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-9" tabindex="-1"></a><span class="co">#   # conditional statements for calculate liquid input to the ground</span></span>
<span id="cb55-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-10" tabindex="-1"></a><span class="co">#   mutate(input.mm = if_else(Pdiff.mm &gt; 0 &amp; SWEdiff.mm, 0, 0),</span></span>
<span id="cb55-11"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-11" tabindex="-1"></a><span class="co">#          input.mm = if_else(Pdiff.mm == 0 &amp; SWEdiff.mm &lt; 0, -SWEdiff.mm, input.mm),</span></span>
<span id="cb55-12"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-12" tabindex="-1"></a><span class="co">#          input.mm = if_else(Pdiff.mm &gt; 0 &amp; SWEdiff.mm &lt; 0, Pdiff.mm - SWEdiff.mm, input.mm),</span></span>
<span id="cb55-13"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-13" tabindex="-1"></a><span class="co">#          input.mm = if_else(Pdiff.mm &gt; 0 &amp; SWEdiff.mm == 0, Pdiff.mm, input.mm)) %&gt;%</span></span>
<span id="cb55-14"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-14" tabindex="-1"></a><span class="co">#   # this replaces missing air temp values with 0</span></span>
<span id="cb55-15"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-15" tabindex="-1"></a><span class="co">#   mutate(temp_mean.c = replace_na(temp_mean.c, 0)) %&gt;%</span></span>
<span id="cb55-16"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-16" tabindex="-1"></a><span class="co">#   # this is a check that prevents liquid inputs when the air temp is below 0</span></span>
<span id="cb55-17"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-17" tabindex="-1"></a><span class="co">#   mutate(input.mm = if_else(temp_mean.c &lt; 0 &amp; input.mm &gt; 0, 0, input.mm)) %&gt;%</span></span>
<span id="cb55-18"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb55-18" tabindex="-1"></a><span class="co">#   mutate(date = lubridate::ymd(date))</span></span></code></pre></div>
<p>Question 2: In plain language, explain each step of the 5 if-else statements above (~5 brief sentences) (3pts).</p>
<p>ANSWER:</p>
<div class="sourceCode" id="cb56"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb56-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb56-1" tabindex="-1"></a><span class="co"># # Create a cumulative input column for visualization and calculations</span></span>
<span id="cb56-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb56-2" tabindex="-1"></a><span class="co"># sntl &lt;- sntl %&gt;%</span></span>
<span id="cb56-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb56-3" tabindex="-1"></a><span class="co">#   group_by(wtr_yr) %&gt;%</span></span>
<span id="cb56-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb56-4" tabindex="-1"></a><span class="co">#   mutate(cum_input.mm = cumsum(input.mm)) %&gt;% # generate a cumulative sum column for each water year</span></span>
<span id="cb56-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb56-5" tabindex="-1"></a><span class="co">#   ungroup()</span></span></code></pre></div>
<p>Let’s visualize the timing disparities between precipitation and melt input in relation to discharge.</p>
<div class="sourceCode" id="cb57"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb57-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-1" tabindex="-1"></a><span class="co"># # Convert date column to POSIXct format</span></span>
<span id="cb57-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-2" tabindex="-1"></a><span class="co"># fool_q$date &lt;- as.POSIXct(fool_q$date)</span></span>
<span id="cb57-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-3" tabindex="-1"></a><span class="co"># sntl$date &lt;- as.POSIXct(sntl$date)</span></span>
<span id="cb57-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-4" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb57-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-5" tabindex="-1"></a><span class="co"># # Plot imported SWE, precip, and depth data</span></span>
<span id="cb57-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-6" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb57-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-7" tabindex="-1"></a><span class="co">#   # Scale discharge for the right y-axis</span></span>
<span id="cb57-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-8" tabindex="-1"></a><span class="co">#   geom_line(data = fool_q, aes(x = date, y = m3_s*10000, color = &#39;m^3/second&#39;)) +</span></span>
<span id="cb57-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-9" tabindex="-1"></a><span class="co">#   geom_point(data = sntl, aes(x = date, y = cum_input.mm, color = &#39;cumulative input (mm)&#39;)) +</span></span>
<span id="cb57-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-10" tabindex="-1"></a><span class="co">#   geom_point(data = sntl, aes(x = date, y = pcumul.mm, color = &#39;cumulative precipitation (mm)&#39;)) +</span></span>
<span id="cb57-11"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-11" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis labels by 45 degrees</span></span>
<span id="cb57-12"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-12" tabindex="-1"></a><span class="co">#         axis.line = element_line(color = &quot;black&quot;),  # Add black axis lines</span></span>
<span id="cb57-13"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-13" tabindex="-1"></a><span class="co">#         panel.background = element_rect(fill = &quot;white&quot;),  # Set panel background to white</span></span>
<span id="cb57-14"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-14" tabindex="-1"></a><span class="co">#         panel.grid.major = element_blank(),  # Remove major grid lines</span></span>
<span id="cb57-15"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-15" tabindex="-1"></a><span class="co">#         panel.grid.minor = element_blank(), # Remove minor grid lines</span></span>
<span id="cb57-16"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-16" tabindex="-1"></a><span class="co">#         ) + </span></span>
<span id="cb57-17"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-17" tabindex="-1"></a><span class="co">#   ylab(&quot;mm&quot;) +</span></span>
<span id="cb57-18"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-18" tabindex="-1"></a><span class="co">#   xlab(&#39;Date&#39;) +</span></span>
<span id="cb57-19"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb57-19" tabindex="-1"></a><span class="co">#   scale_y_continuous(sec.axis = sec_axis(trans = ~ . / 10000, name = expression(Q[paste(m^3,&#39;/second&#39;)])))</span></span></code></pre></div>
<div class="sourceCode" id="cb58"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb58-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb58-1" tabindex="-1"></a><span class="co">#print(max(sntl$cum_input.mm, na.rm = TRUE))</span></span>
<span id="cb58-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb58-2" tabindex="-1"></a><span class="co">#print(max(sntl$pcumul.mm, na.rm = TRUE ))</span></span></code></pre></div>
<p>Question 3. What processes could account for the differences between cumulative input, calculated from SWE data, and cumulative precipitation, both measured at the same SNOTEL station? (1 or 2 processes) What could explain the discrepancy if the cumulative input, is found to be less than the cumulative precipitation measured at the same SNOTEL station? (at least 2 possible processes) (4 points) (2-3 sentences)</p>
<p>ANSWER:</p>
</div>
</div>
<div id="modeling-swe" class="section level2 hasAnchor" number="9.7">
<h2><span class="header-section-number">9.7</span> Modeling SWE<a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#modeling-swe" class="anchor-section" aria-label="Anchor link to header"></a></h2>
<p>Let’s assume that we have a precipitation gage at 3400m in Fool Creek, but without SWE data, how could we model SWE using temperature?</p>
<div class="sourceCode" id="cb59"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb59-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb59-1" tabindex="-1"></a><span class="co"># # Filter to a single water year for the snowmelt model</span></span>
<span id="cb59-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb59-2" tabindex="-1"></a><span class="co"># wateryr = &#39;2021&#39;</span></span>
<span id="cb59-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb59-3" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb59-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb59-4" tabindex="-1"></a><span class="co"># # set the year</span></span>
<span id="cb59-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb59-5" tabindex="-1"></a><span class="co"># sntl_SINGLE_YEAR &lt;- sntl %&gt;%</span></span>
<span id="cb59-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb59-6" tabindex="-1"></a><span class="co">#   filter(wtr_yr == wateryr) </span></span>
<span id="cb59-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb59-7" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb59-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb59-8" tabindex="-1"></a><span class="co"># print(sum(sntl_SINGLE_YEAR$input.mm))</span></span></code></pre></div>
<p>The model below is a variation of the <a href="https://www.researchgate.net/publication/229698275_Revisiting_the_Degree-day_Method_for_Snowmelt_Computations" target="_blank">degree-day method</a>. Here we are running a similar script to the input calculations above, using temperature as the primary determinant. When the temperature falls below a certain threshold and precipitation occurs, an equivalent amount is added to our SWE accumulation. We’ll conduct a simulation with 100 Monte Carlo runs and analyze the optimal outcome. The parameters we are testing are pack threshold, a degree-day factor, and the threshold temperature for determining rain from snow.</p>
<div class="sourceCode" id="cb60"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb60-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-1" tabindex="-1"></a><span class="co"># ########################################</span></span>
<span id="cb60-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-2" tabindex="-1"></a><span class="co"># # nx sets the number of Monte Carlo runs</span></span>
<span id="cb60-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-3" tabindex="-1"></a><span class="co"># nx &lt;- 100 # number of runs</span></span>
<span id="cb60-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-4" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-5" tabindex="-1"></a><span class="co"># # set up the parameter matrix</span></span>
<span id="cb60-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-6" tabindex="-1"></a><span class="co"># param &lt;- tibble(</span></span>
<span id="cb60-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-7" tabindex="-1"></a><span class="co">#   Run = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb60-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-8" tabindex="-1"></a><span class="co">#   ddf = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb60-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-9" tabindex="-1"></a><span class="co">#   Tb = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb60-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-10" tabindex="-1"></a><span class="co">#   pack_threshold = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb60-11"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-11" tabindex="-1"></a><span class="co">#   nse = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb60-12"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-12" tabindex="-1"></a><span class="co">#   kge = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb60-13"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-13" tabindex="-1"></a><span class="co">#   SWEsim = vector(mode = &quot;list&quot;, nx)</span></span>
<span id="cb60-14"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-14" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb60-15"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-15" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-16"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-16" tabindex="-1"></a><span class="co"># tic(&quot;MC Simulation&quot;)</span></span>
<span id="cb60-17"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-17" tabindex="-1"></a><span class="co"># pb &lt;- progress_bar$new(</span></span>
<span id="cb60-18"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-18" tabindex="-1"></a><span class="co">#   format = &quot; downloading [:bar] :percent eta: :eta&quot;,</span></span>
<span id="cb60-19"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-19" tabindex="-1"></a><span class="co">#   total = nx, clear = FALSE, width = 60</span></span>
<span id="cb60-20"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-20" tabindex="-1"></a><span class="co"># ) # initialize progress bar</span></span>
<span id="cb60-21"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-21" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-22"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-22" tabindex="-1"></a><span class="co"># #### MONTE CARLO SETUP (use ii as index)</span></span>
<span id="cb60-23"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-23" tabindex="-1"></a><span class="co"># for (n in 1:nx) {</span></span>
<span id="cb60-24"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-24" tabindex="-1"></a><span class="co">#   pb$tick() # needed for progress bar</span></span>
<span id="cb60-25"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-25" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-26"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-26" tabindex="-1"></a><span class="co">#   # write run number into the parameter matrix</span></span>
<span id="cb60-27"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-27" tabindex="-1"></a><span class="co">#   param$Run[n] &lt;- n</span></span>
<span id="cb60-28"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-28" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-29"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-29" tabindex="-1"></a><span class="co"># #####################</span></span>
<span id="cb60-30"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-30" tabindex="-1"></a><span class="co"># # initiate parameters</span></span>
<span id="cb60-31"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-31" tabindex="-1"></a><span class="co">#   param$ddf[n] &lt;- runif(1, 0, 5) # Threshold temperature for distinguishing rain from snow.</span></span>
<span id="cb60-32"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-32" tabindex="-1"></a><span class="co">#   param$Tb[n] &lt;- runif(1, -5, 5) # Degree-day factor for snowmelt calculations, utilized in calculating the potential melt (Melt) based on the difference between the mean temperature (temp_mean.c) and Tb.</span></span>
<span id="cb60-33"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-33" tabindex="-1"></a><span class="co">#   param$pack_threshold[n] &lt;- runif(1, 0, 100) #threshold value used in determining whether precipitation falls as snow or accumulates on existing snowpack</span></span>
<span id="cb60-34"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-34" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-35"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-35" tabindex="-1"></a><span class="co"># ########################################</span></span>
<span id="cb60-36"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-36" tabindex="-1"></a><span class="co"># # generate columns with snow, rain, melt</span></span>
<span id="cb60-37"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-37" tabindex="-1"></a><span class="co">#   SWE.Model &lt;- sntl_SINGLE_YEAR %&gt;%</span></span>
<span id="cb60-38"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-38" tabindex="-1"></a><span class="co">#     # liquid precipitation</span></span>
<span id="cb60-39"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-39" tabindex="-1"></a><span class="co">#     mutate(Rain = if_else(Pdiff.mm &gt; 0 &amp; temp_mean.c &gt;= param$Tb[n], Pdiff.mm, 0)) %&gt;%</span></span>
<span id="cb60-40"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-40" tabindex="-1"></a><span class="co">#    # snow accumulation</span></span>
<span id="cb60-41"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-41" tabindex="-1"></a><span class="co">#     mutate(Snow = if_else(Pdiff.mm &gt; 0 &amp; temp_mean.c &lt; param$Tb[n], Pdiff.mm, 0)) %&gt;%</span></span>
<span id="cb60-42"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-42" tabindex="-1"></a><span class="co">#   # potential melt</span></span>
<span id="cb60-43"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-43" tabindex="-1"></a><span class="co">#     mutate(Melt = if_else(temp_mean.c &gt; param$Tb[n], param$ddf[n]*(temp_mean.c - param$Tb[n]), 0)) %&gt;%</span></span>
<span id="cb60-44"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-44" tabindex="-1"></a><span class="co">#   # cumulative SWE without melt</span></span>
<span id="cb60-45"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-45" tabindex="-1"></a><span class="co">#     mutate(SWE.cumul = cumsum(Snow)) %&gt;%</span></span>
<span id="cb60-46"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-46" tabindex="-1"></a><span class="co">#   # no melt if swe &lt;= 0 (here only for first few steps)</span></span>
<span id="cb60-47"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-47" tabindex="-1"></a><span class="co">#      mutate(Melt = if_else(SWE.cumul == 0, 0, Melt))</span></span>
<span id="cb60-48"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-48" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-49"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-49" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-50"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-50" tabindex="-1"></a><span class="co"># ########################################</span></span>
<span id="cb60-51"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-51" tabindex="-1"></a><span class="co"># # for loop to loop through each timestep</span></span>
<span id="cb60-52"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-52" tabindex="-1"></a><span class="co">#   SWEsim &lt;- vector()</span></span>
<span id="cb60-53"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-53" tabindex="-1"></a><span class="co">#   SWEsim[1] &lt;- 0 # set first value to 0</span></span>
<span id="cb60-54"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-54" tabindex="-1"></a><span class="co">#   for (ii in 2:dim(SWE.Model)[1]) {</span></span>
<span id="cb60-55"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-55" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-56"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-56" tabindex="-1"></a><span class="co">#   # snow accumulation if snowfall happens</span></span>
<span id="cb60-57"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-57" tabindex="-1"></a><span class="co">#     SWEsim[ii] &lt;- if_else(SWE.Model$Snow[ii] &gt; 0, SWE.Model$Snow[ii]+SWEsim[ii-1],</span></span>
<span id="cb60-58"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-58" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-59"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-59" tabindex="-1"></a><span class="co"># #This condition checks if the existing snow water equivalent (SWE) surpasses the pack threshold. If so, then the precipitation is considered to contribute to the snowpack rather than falling as rain</span></span>
<span id="cb60-60"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-60" tabindex="-1"></a><span class="co">#   # snow accumulation if liquid precip but snow on the ground</span></span>
<span id="cb60-61"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-61" tabindex="-1"></a><span class="co">#     if_else(SWE.Model$Rain[ii] &gt; 0 &amp; SWEsim[ii-1] &gt; param$pack_threshold[n], SWE.Model$Rain[ii]+SWEsim[ii-1],</span></span>
<span id="cb60-62"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-62" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-63"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-63" tabindex="-1"></a><span class="co">#   # melt if SWEsim on the ground larger than the melt pulse</span></span>
<span id="cb60-64"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-64" tabindex="-1"></a><span class="co">#     if_else(SWE.Model$Melt[ii] &gt; 0 &amp; SWEsim[ii-1] &gt; SWE.Model$Melt[ii], SWEsim[ii-1] - SWE.Model$Melt[ii],</span></span>
<span id="cb60-65"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-65" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-66"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-66" tabindex="-1"></a><span class="co">#   # melt if SWEsim is present but smaller than melt pulse</span></span>
<span id="cb60-67"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-67" tabindex="-1"></a><span class="co">#   if_else(SWE.Model$Melt[ii] &gt; 0 &amp; SWEsim[ii-1] &lt; SWE.Model$Melt[ii], 0, SWEsim[ii-1]))))</span></span>
<span id="cb60-68"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-68" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb60-69"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-69" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-70"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-70" tabindex="-1"></a><span class="co"># # store simulated SWEsim in df</span></span>
<span id="cb60-71"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-71" tabindex="-1"></a><span class="co"># param$SWEsim[n] &lt;- list(SWEsim)</span></span>
<span id="cb60-72"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-72" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-73"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-73" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-74"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-74" tabindex="-1"></a><span class="co"># ####################</span></span>
<span id="cb60-75"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-75" tabindex="-1"></a><span class="co"># # We will store efficiencies comparing observed SWE with simulated SWE.</span></span>
<span id="cb60-76"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-76" tabindex="-1"></a><span class="co"># # NSE</span></span>
<span id="cb60-77"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-77" tabindex="-1"></a><span class="co">#     param$nse[n] &lt;- 1 - ((sum((SWE.Model$swe.mm - SWEsim)^2)) / sum(((SWE.Model$swe.mm - mean(SWE.Model$swe.mm))^2)))</span></span>
<span id="cb60-78"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-78" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-79"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-79" tabindex="-1"></a><span class="co">#     # KGE</span></span>
<span id="cb60-80"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-80" tabindex="-1"></a><span class="co">#     kge_r &lt;- cor(SWE.Model$swe.mm, SWEsim)</span></span>
<span id="cb60-81"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-81" tabindex="-1"></a><span class="co">#     kge_beta &lt;- mean(SWEsim) / mean(SWE.Model$swe.mm)</span></span>
<span id="cb60-82"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-82" tabindex="-1"></a><span class="co">#     kge_gamma &lt;- (sd(SWEsim) / mean(SWEsim)) / (sd(SWE.Model$swe.mm) / mean(SWE.Model$swe.mm))</span></span>
<span id="cb60-83"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-83" tabindex="-1"></a><span class="co">#     param$kge[n] &lt;- 1 - sqrt((kge_r - 1)^2 + (kge_beta - 1)^2 + (kge_gamma - 1)^2)</span></span>
<span id="cb60-84"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-84" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-85"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-85" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-86"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-86" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb60-87"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-87" tabindex="-1"></a><span class="co"># toc()</span></span>
<span id="cb60-88"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-88" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-89"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-89" tabindex="-1"></a><span class="co"># #########################################</span></span>
<span id="cb60-90"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-90" tabindex="-1"></a><span class="co"># # sort parameter matrix from highest to lowest NSE and save it</span></span>
<span id="cb60-91"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-91" tabindex="-1"></a><span class="co"># param &lt;- arrange(param, desc(nse))</span></span>
<span id="cb60-92"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-92" tabindex="-1"></a><span class="co"># save(param, file = paste(wateryr, &quot;SWE.Model.Runs.RData&quot;, sep = &quot;.&quot;))</span></span>
<span id="cb60-93"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-93" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb60-94"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-94" tabindex="-1"></a><span class="co"># # best run</span></span>
<span id="cb60-95"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-95" tabindex="-1"></a><span class="co"># # take the best run, get the list of simulated values and unlist it in order to store it in a dataframe</span></span>
<span id="cb60-96"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb60-96" tabindex="-1"></a><span class="co"># SWE.Model$SWEsim.mm &lt;- unlist(param$SWEsim[1])</span></span></code></pre></div>
<div class="sourceCode" id="cb61"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb61-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb61-1" tabindex="-1"></a><span class="co"># # Plot best run</span></span>
<span id="cb61-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb61-2" tabindex="-1"></a><span class="co"># swe_plot &lt;- ggplot(data = SWE.Model) +</span></span>
<span id="cb61-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb61-3" tabindex="-1"></a><span class="co">#   geom_line(aes(x = date, y = SWEsim.mm, color = &quot;Simulated SWE&quot;)) +</span></span>
<span id="cb61-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb61-4" tabindex="-1"></a><span class="co">#   geom_line(aes(x = date, y = swe.mm, color = &quot;Actual SWE&quot;)) +</span></span>
<span id="cb61-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb61-5" tabindex="-1"></a><span class="co">#   annotate(&quot;text&quot;, x = mean(SWE.Model$date, na.rm = TRUE), y = min(SWE.Model$swe.mm, na.rm = TRUE), </span></span>
<span id="cb61-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb61-6" tabindex="-1"></a><span class="co">#            label = paste(&quot;NSE =&quot;, round(param$nse[1], 2)), hjust = 1, vjust = 1)</span></span>
<span id="cb61-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb61-7" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb61-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb61-8" tabindex="-1"></a><span class="co"># ggplotly(swe_plot)</span></span></code></pre></div>
<p>This simple model seems to simulate SWE well if assessed with the NSE. Let’s model SWE at the Fool Creek outlet, where we do not have daily SWE data. First we’ll bring in precipitation data, measured at a USFS maintained meteorological station located near the Fool outlet:</p>
<div class="sourceCode" id="cb62"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb62-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb62-1" tabindex="-1"></a><span class="co"># fc_precip &lt;- read.csv(&quot;LFCmet_WY21_WY22.csv&quot;) %&gt;%</span></span>
<span id="cb62-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb62-2" tabindex="-1"></a><span class="co">#   mutate(date = lubridate::mdy_hm(TS)) %&gt;%</span></span>
<span id="cb62-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb62-3" tabindex="-1"></a><span class="co">#   select(date, water_year, PPT_10min..mm.) %&gt;%</span></span>
<span id="cb62-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb62-4" tabindex="-1"></a><span class="co">#   filter(water_year %in% c(2021, 2022))</span></span></code></pre></div>
<p>We also need temperature data. This is also collected at the USFS Lower Fool meteorological station.</p>
<div class="sourceCode" id="cb63"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb63-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-1" tabindex="-1"></a><span class="co"># fc_temp &lt;- read.csv(&quot;lfc_airtemp.csv&quot;) %&gt;%</span></span>
<span id="cb63-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-2" tabindex="-1"></a><span class="co">#   mutate(date = lubridate::mdy_hm(TMSTAMP)) %&gt;%</span></span>
<span id="cb63-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-3" tabindex="-1"></a><span class="co">#   mutate(wtr_yr = if_else(month(date) &lt; 10, year(date), year(date) + 1)) %&gt;%</span></span>
<span id="cb63-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-4" tabindex="-1"></a><span class="co">#   select(date, Air_TempC_Avg, wtr_yr) %&gt;%</span></span>
<span id="cb63-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-5" tabindex="-1"></a><span class="co">#   filter(wtr_yr %in% c(2021, 2022))</span></span>
<span id="cb63-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-6" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb63-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-7" tabindex="-1"></a><span class="co"># lfc_data &lt;- merge(fc_temp, fc_precip, by = &quot;date&quot;, validate = &quot;one_to_one&quot;) %&gt;%</span></span>
<span id="cb63-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-8" tabindex="-1"></a><span class="co">#   select(date, Air_TempC_Avg, wtr_yr, PPT_10min..mm.) %&gt;%</span></span>
<span id="cb63-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-9" tabindex="-1"></a><span class="co">#   rename(precip.mm  = PPT_10min..mm.,</span></span>
<span id="cb63-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-10" tabindex="-1"></a><span class="co">#          temp_mean.c = Air_TempC_Avg) </span></span>
<span id="cb63-11"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-11" tabindex="-1"></a><span class="co">#   # rename columns so we can reuse the SWE model without changing variable names within the simulation code</span></span>
<span id="cb63-12"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-12" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb63-13"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-13" tabindex="-1"></a><span class="co"># # Lets add cumulative precip totals by water year</span></span>
<span id="cb63-14"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-14" tabindex="-1"></a><span class="co"># lfc_data &lt;- lfc_data %&gt;%</span></span>
<span id="cb63-15"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-15" tabindex="-1"></a><span class="co">#   group_by(wtr_yr) %&gt;%</span></span>
<span id="cb63-16"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-16" tabindex="-1"></a><span class="co">#   mutate(pcumul.mm = cumsum(precip.mm)) %&gt;% # generate a cumulative sum column for each water year</span></span>
<span id="cb63-17"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-17" tabindex="-1"></a><span class="co">#   ungroup()</span></span>
<span id="cb63-18"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-18" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb63-19"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-19" tabindex="-1"></a><span class="co"># # Aggregate all data to daily means for the sake of simulation time</span></span>
<span id="cb63-20"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-20" tabindex="-1"></a><span class="co"># lfc_data &lt;- lfc_data %&gt;%</span></span>
<span id="cb63-21"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-21" tabindex="-1"></a><span class="co">#   group_by(date = as.Date(date)) %&gt;%</span></span>
<span id="cb63-22"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb63-22" tabindex="-1"></a><span class="co">#   summarise(across(.cols = everything(), .fns = mean, na.rm = TRUE))</span></span></code></pre></div>
<p>Even though this meteorological station is very close to the SNOTEL station, lets compare the values between the upper watershed and the lower</p>
<div class="sourceCode" id="cb64"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb64-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-1" tabindex="-1"></a><span class="co"># # Convert date column in sntl to Date format that matches lfc_data</span></span>
<span id="cb64-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-2" tabindex="-1"></a><span class="co"># sntl$date &lt;- as.Date(sntl$date)</span></span>
<span id="cb64-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-3" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb64-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-4" tabindex="-1"></a><span class="co"># ggplot() +</span></span>
<span id="cb64-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-5" tabindex="-1"></a><span class="co">#   # Scale discharge for the right y-axis</span></span>
<span id="cb64-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-6" tabindex="-1"></a><span class="co">#   geom_point(data = lfc_data, aes(x = date, y = pcumul.mm, color = &#39;lower fool creek precip (mm)&#39;)) +</span></span>
<span id="cb64-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-7" tabindex="-1"></a><span class="co">#   geom_point(data = sntl, aes(x = date, y = pcumul.mm, color = &#39;upper fool creek precip (mm)&#39;)) +</span></span>
<span id="cb64-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-8" tabindex="-1"></a><span class="co">#   theme(axis.text.x = element_text(angle = 45, hjust = 1), # Rotate x-axis </span></span>
<span id="cb64-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-9" tabindex="-1"></a><span class="co">#         panel.grid.minor = element_blank(), # Remove minor grid lines</span></span>
<span id="cb64-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-10" tabindex="-1"></a><span class="co">#         ) + </span></span>
<span id="cb64-11"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-11" tabindex="-1"></a><span class="co">#   ylab(&quot;mm&quot;) +</span></span>
<span id="cb64-12"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb64-12" tabindex="-1"></a><span class="co">#   xlab(&#39;Date&#39;) </span></span></code></pre></div>
<p>Now let’s estimate SWE for the Lower Fool Creek.
Again, we’ll just simulate a single year.</p>
<div class="sourceCode" id="cb65"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb65-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-1" tabindex="-1"></a><span class="co"># # Filter to a single water year for the snowmelt model</span></span>
<span id="cb65-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-2" tabindex="-1"></a><span class="co"># wateryr = &#39;2021&#39;</span></span>
<span id="cb65-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-3" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb65-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-4" tabindex="-1"></a><span class="co"># # aggregate data to daily means for the sake of simulation time</span></span>
<span id="cb65-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-5" tabindex="-1"></a><span class="co"># lfc_data &lt;- lfc_data %&gt;%</span></span>
<span id="cb65-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-6" tabindex="-1"></a><span class="co">#   mutate(Pdiff.mm = pcumul.mm - lag(pcumul.mm, default = first(pcumul.mm)))</span></span>
<span id="cb65-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-7" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb65-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-8" tabindex="-1"></a><span class="co"># # set the year</span></span>
<span id="cb65-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-9" tabindex="-1"></a><span class="co"># lfc_SINGLE_YEAR &lt;- lfc_data %&gt;%</span></span>
<span id="cb65-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb65-10" tabindex="-1"></a><span class="co">#   filter(wtr_yr == wateryr) </span></span></code></pre></div>
<p>Run another set of simulations and compare the values of the best performing parameters across sites.</p>
<div class="sourceCode" id="cb66"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb66-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-1" tabindex="-1"></a><span class="co"># ########################################</span></span>
<span id="cb66-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-2" tabindex="-1"></a><span class="co"># # nx sets the number of Monte Carlo runs</span></span>
<span id="cb66-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-3" tabindex="-1"></a><span class="co"># nx &lt;- 100 # number of runs</span></span>
<span id="cb66-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-4" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-5" tabindex="-1"></a><span class="co"># # set up the parameter matrix</span></span>
<span id="cb66-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-6" tabindex="-1"></a><span class="co"># param &lt;- tibble(</span></span>
<span id="cb66-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-7" tabindex="-1"></a><span class="co">#   Run = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb66-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-8" tabindex="-1"></a><span class="co">#   ddf = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb66-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-9" tabindex="-1"></a><span class="co">#   Tb = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb66-10"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-10" tabindex="-1"></a><span class="co">#   pack_threshold = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb66-11"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-11" tabindex="-1"></a><span class="co">#   nse = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb66-12"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-12" tabindex="-1"></a><span class="co">#   kge = vector(mode = &quot;double&quot;, nx),</span></span>
<span id="cb66-13"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-13" tabindex="-1"></a><span class="co">#   SWEsim = vector(mode = &quot;list&quot;, nx)</span></span>
<span id="cb66-14"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-14" tabindex="-1"></a><span class="co"># )</span></span>
<span id="cb66-15"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-15" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-16"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-16" tabindex="-1"></a><span class="co"># tic(&quot;MC Simulation&quot;)</span></span>
<span id="cb66-17"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-17" tabindex="-1"></a><span class="co"># pb &lt;- progress_bar$new(</span></span>
<span id="cb66-18"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-18" tabindex="-1"></a><span class="co">#   format = &quot; downloading [:bar] :percent eta: :eta&quot;,</span></span>
<span id="cb66-19"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-19" tabindex="-1"></a><span class="co">#   total = nx, clear = FALSE, width = 60</span></span>
<span id="cb66-20"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-20" tabindex="-1"></a><span class="co"># ) # initialize progress bar</span></span>
<span id="cb66-21"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-21" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-22"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-22" tabindex="-1"></a><span class="co"># #### MONTE CARLO SETUP (use ii as index)</span></span>
<span id="cb66-23"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-23" tabindex="-1"></a><span class="co"># for (n in 1:nx) {</span></span>
<span id="cb66-24"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-24" tabindex="-1"></a><span class="co">#   pb$tick() # needed for progress bar</span></span>
<span id="cb66-25"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-25" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-26"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-26" tabindex="-1"></a><span class="co">#   # write run number into the parameter matrix</span></span>
<span id="cb66-27"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-27" tabindex="-1"></a><span class="co">#   param$Run[n] &lt;- n</span></span>
<span id="cb66-28"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-28" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-29"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-29" tabindex="-1"></a><span class="co"># #####################</span></span>
<span id="cb66-30"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-30" tabindex="-1"></a><span class="co"># # initiate parameters</span></span>
<span id="cb66-31"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-31" tabindex="-1"></a><span class="co">#   param$ddf[n] &lt;- runif(1, 0, 5) # Threshold temperature for distinguishing rain from snow.</span></span>
<span id="cb66-32"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-32" tabindex="-1"></a><span class="co">#   param$Tb[n] &lt;- runif(1, -5, 5) # Degree-day factor for snowmelt calculations, utilized in calculating the potential melt (Melt) based on the difference between the mean temperature (temp_mean.c) and Tb.</span></span>
<span id="cb66-33"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-33" tabindex="-1"></a><span class="co">#   param$pack_threshold[n] &lt;- runif(1, 0, 100) #threshold value used in determining whether precipitation falls as snow or accumulates on existing snowpack</span></span>
<span id="cb66-34"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-34" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-35"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-35" tabindex="-1"></a><span class="co"># ########################################</span></span>
<span id="cb66-36"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-36" tabindex="-1"></a><span class="co"># # generate columns with snow, rain, melt</span></span>
<span id="cb66-37"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-37" tabindex="-1"></a><span class="co">#   SWE.Modellfc &lt;- lfc_SINGLE_YEAR %&gt;%</span></span>
<span id="cb66-38"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-38" tabindex="-1"></a><span class="co">#     # liquid precipitation</span></span>
<span id="cb66-39"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-39" tabindex="-1"></a><span class="co">#     mutate(Rain = if_else(Pdiff.mm &gt; 0 &amp; temp_mean.c &gt;= param$Tb[n], Pdiff.mm, 0)) %&gt;%</span></span>
<span id="cb66-40"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-40" tabindex="-1"></a><span class="co">#    # snow accumulation</span></span>
<span id="cb66-41"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-41" tabindex="-1"></a><span class="co">#     mutate(Snow = if_else(Pdiff.mm &gt; 0 &amp; temp_mean.c &lt; param$Tb[n], Pdiff.mm, 0)) %&gt;%</span></span>
<span id="cb66-42"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-42" tabindex="-1"></a><span class="co">#   # potential melt</span></span>
<span id="cb66-43"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-43" tabindex="-1"></a><span class="co">#     mutate(Melt = if_else(temp_mean.c &gt; param$Tb[n], param$ddf[n]*(temp_mean.c - param$Tb[n]), 0)) %&gt;%</span></span>
<span id="cb66-44"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-44" tabindex="-1"></a><span class="co">#   # cumulative SWE without melt</span></span>
<span id="cb66-45"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-45" tabindex="-1"></a><span class="co">#     mutate(SWE.cumul = cumsum(Snow)) %&gt;%</span></span>
<span id="cb66-46"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-46" tabindex="-1"></a><span class="co">#   # no melt if swe &lt;= 0 (here only for first few steps)</span></span>
<span id="cb66-47"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-47" tabindex="-1"></a><span class="co">#      mutate(Melt = if_else(SWE.cumul == 0, 0, Melt))</span></span>
<span id="cb66-48"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-48" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-49"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-49" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-50"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-50" tabindex="-1"></a><span class="co"># ########################################</span></span>
<span id="cb66-51"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-51" tabindex="-1"></a><span class="co"># # for loop to loop through each timestep</span></span>
<span id="cb66-52"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-52" tabindex="-1"></a><span class="co">#   SWEsim &lt;- vector()</span></span>
<span id="cb66-53"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-53" tabindex="-1"></a><span class="co">#   SWEsim[1] &lt;- 0 # set first value to 0</span></span>
<span id="cb66-54"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-54" tabindex="-1"></a><span class="co">#   for (ii in 2:dim(SWE.Modellfc)[1]) {</span></span>
<span id="cb66-55"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-55" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-56"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-56" tabindex="-1"></a><span class="co">#   # snow accumulation if snowfall happens</span></span>
<span id="cb66-57"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-57" tabindex="-1"></a><span class="co">#     SWEsim[ii] &lt;- if_else(SWE.Modellfc$Snow[ii] &gt; 0, SWE.Modellfc$Snow[ii]+SWEsim[ii-1],</span></span>
<span id="cb66-58"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-58" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-59"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-59" tabindex="-1"></a><span class="co">#   # snow accumulation if liquid precip but snow on the ground</span></span>
<span id="cb66-60"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-60" tabindex="-1"></a><span class="co">#     if_else(SWE.Modellfc$Rain[ii] &gt; 0 &amp; SWEsim[ii-1] &gt; param$pack_threshold[n], SWE.Model$Rain[ii]+SWEsim[ii-1],</span></span>
<span id="cb66-61"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-61" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-62"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-62" tabindex="-1"></a><span class="co">#   # melt if SWEsim on the ground larger than the melt pulse</span></span>
<span id="cb66-63"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-63" tabindex="-1"></a><span class="co">#     if_else(SWE.Modellfc$Melt[ii] &gt; 0 &amp; SWEsim[ii-1] &gt; SWE.Modellfc$Melt[ii], SWEsim[ii-1] - SWE.Modellfc$Melt[ii],</span></span>
<span id="cb66-64"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-64" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-65"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-65" tabindex="-1"></a><span class="co">#   # melt if SWEsim is present but smaller than melt pulse</span></span>
<span id="cb66-66"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-66" tabindex="-1"></a><span class="co">#   if_else(SWE.Modellfc$Melt[ii] &gt; 0 &amp; SWEsim[ii-1] &lt; SWE.Modellfc$Melt[ii], 0, SWEsim[ii-1]))))</span></span>
<span id="cb66-67"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-67" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb66-68"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-68" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-69"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-69" tabindex="-1"></a><span class="co"># # store simulated SWEsim in df</span></span>
<span id="cb66-70"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-70" tabindex="-1"></a><span class="co"># param$SWEsim[n] &lt;- list(SWEsim)</span></span>
<span id="cb66-71"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-71" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-72"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-72" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-73"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-73" tabindex="-1"></a><span class="co"># ####################</span></span>
<span id="cb66-74"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-74" tabindex="-1"></a><span class="co"># # We will store efficiencies comparing observed SWE with simulated SWE.</span></span>
<span id="cb66-75"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-75" tabindex="-1"></a><span class="co"># # NSE</span></span>
<span id="cb66-76"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-76" tabindex="-1"></a><span class="co">#     param$nse[n] &lt;- 1 - ((sum((SWE.Model$swe.mm - SWEsim)^2)) / sum(((SWE.Model$swe.mm - mean(SWE.Model$swe.mm))^2)))</span></span>
<span id="cb66-77"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-77" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-78"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-78" tabindex="-1"></a><span class="co">#     # KGE</span></span>
<span id="cb66-79"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-79" tabindex="-1"></a><span class="co">#     kge_r &lt;- cor(SWE.Model$swe.mm, SWEsim)</span></span>
<span id="cb66-80"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-80" tabindex="-1"></a><span class="co">#     kge_beta &lt;- mean(SWEsim) / mean(SWE.Model$swe.mm)</span></span>
<span id="cb66-81"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-81" tabindex="-1"></a><span class="co">#     kge_gamma &lt;- (sd(SWEsim) / mean(SWEsim)) / (sd(SWE.Model$swe.mm) / mean(SWE.Model$swe.mm))</span></span>
<span id="cb66-82"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-82" tabindex="-1"></a><span class="co">#     param$kge[n] &lt;- 1 - sqrt((kge_r - 1)^2 + (kge_beta - 1)^2 + (kge_gamma - 1)^2)</span></span>
<span id="cb66-83"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-83" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-84"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-84" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-85"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-85" tabindex="-1"></a><span class="co"># }</span></span>
<span id="cb66-86"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-86" tabindex="-1"></a><span class="co"># toc()</span></span>
<span id="cb66-87"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-87" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-88"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-88" tabindex="-1"></a><span class="co"># #########################################</span></span>
<span id="cb66-89"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-89" tabindex="-1"></a><span class="co"># # sort parameter matrix from highest to lowest NSE and save it</span></span>
<span id="cb66-90"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-90" tabindex="-1"></a><span class="co"># param_lfc &lt;- arrange(param, desc(nse))</span></span>
<span id="cb66-91"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-91" tabindex="-1"></a><span class="co"># # Can save simulated data if desired</span></span>
<span id="cb66-92"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-92" tabindex="-1"></a><span class="co"># #save(param_lfc, file = paste(wateryr, &quot;SWE_lfc.Model.Runs.RData&quot;, sep = &quot;.&quot;))</span></span>
<span id="cb66-93"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-93" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-94"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-94" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb66-95"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-95" tabindex="-1"></a><span class="co"># # take the best run, get the list of simulated values and unlist it in order to store it in a dataframe</span></span>
<span id="cb66-96"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb66-96" tabindex="-1"></a><span class="co"># SWE.Modellfc$SWEsim.mm &lt;- unlist(param_lfc$SWEsim[1])</span></span></code></pre></div>
<p>Since we don’t have SWE measurement for Lower Fool Creek, let’s see how the simulated values compare to acutal Upper Fool SNOTEL SWE measurements.</p>
<div class="sourceCode" id="cb67"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb67-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-1" tabindex="-1"></a><span class="co"># SWE.Model$date &lt;- as.Date(SWE.Model$date)</span></span>
<span id="cb67-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-2" tabindex="-1"></a><span class="co"># # Plot best run</span></span>
<span id="cb67-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-3" tabindex="-1"></a><span class="co"># swe_plot &lt;- ggplot() +</span></span>
<span id="cb67-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-4" tabindex="-1"></a><span class="co">#   geom_line(data = SWE.Modellfc, aes(x = date, y = SWEsim.mm, color = &quot;Simulated SWE&quot;)) +</span></span>
<span id="cb67-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-5" tabindex="-1"></a><span class="co">#   geom_line(data = SWE.Model, aes(x = date, y = swe.mm, color = &quot;Actual SWE&quot;)) +</span></span>
<span id="cb67-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-6" tabindex="-1"></a><span class="co">#   annotate(&quot;text&quot;, x = mean(SWE.Model$date, na.rm = TRUE), y = min(SWE.Model$swe.mm, na.rm = TRUE), </span></span>
<span id="cb67-7"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-7" tabindex="-1"></a><span class="co">#            label = paste(&quot;NSE =&quot;, round(param$nse[1], 2)), hjust = 1, vjust = 1)</span></span>
<span id="cb67-8"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-8" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb67-9"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb67-9" tabindex="-1"></a><span class="co"># ggplotly(swe_plot)</span></span></code></pre></div>
<div class="sourceCode" id="cb68"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb68-1"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb68-1" tabindex="-1"></a><span class="co"># compare the best performing parameters for the Upper Fool Creek and Lower Fool Creek</span></span>
<span id="cb68-2"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb68-2" tabindex="-1"></a><span class="co"># print(param[1, ])</span></span>
<span id="cb68-3"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb68-3" tabindex="-1"></a><span class="co"># print(param_lfc[1, ])</span></span>
<span id="cb68-4"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb68-4" tabindex="-1"></a><span class="co"># </span></span>
<span id="cb68-5"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb68-5" tabindex="-1"></a><span class="co"># # You can change the indexing and wording in this statement if you want to explore all parameters. </span></span>
<span id="cb68-6"><a href="snowmelt-models-for-runoff-timing---lecture-lab-20-pts.html#cb68-6" tabindex="-1"></a><span class="co"># print(paste(&#39;The estimated threshold temperature distinguishing rain from snow in Lower Fool is &#39;, round(param_lfc[1, 2], 2), &#39;degrees and in Upper Fool Creek is&#39;, round(param[1, 2],2), &#39;degrees&#39;))</span></span></code></pre></div>
<p>Question 3: Based on the differences in precipitation and temperature totals between the two sites, are SWE simulation results as you expected? (1 sentence)(2pnts)</p>
<p>ANSWER:</p>
<p>Question 4: How does the estimated threshold temperature distinguishing rain from snow change with elevation? Is the relationship between your parameter estimations as expected? How does this influence your confidence in the model? (2pnts)</p>
<p>ANSWER</p>
<p>Question 4: Compare the precipitation and snow accumulation patterns between two sites. Discuss at least 3 potential natural and/or anthropogenic mechanisms driving the observed variations in precipitation and snow accumulation. Consider the factors you observed in question 1 (3 points)(2-3 sentences).</p>
<p>ANSWER:</p>
<p>Question 5: Let’s say you want to model runoff for the Fool Creek catchment identified above. To do that, you want to estimate the timing and volume of snowmelt for this watershed. Refer to at least 2 model types reviewed in the 06_model_classifications lecture or terms in the lecture above and qualitatively describe a model that you could use to capture the spatial heterogeneity of snow accumulation in this watershed (4 points) (2-4 sentences).</p>
<p>ANSWER:</p>

</div>
</div>
            </section>

          </div>
        </div>
      </div>
<a href="classifying-model-structure---lecture-only-0-pts.html" class="navigation navigation-prev " aria-label="Previous page"><i class="fa fa-angle-left"></i></a>
<a href="learning-module-10---gridded-and-tabular-data-retrieval.html" class="navigation navigation-next " aria-label="Next page"><i class="fa fa-angle-right"></i></a>
    </div>
  </div>
<script src="libs/gitbook-2.6.7/js/app.min.js"></script>
<script src="libs/gitbook-2.6.7/js/clipboard.min.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-search.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-sharing.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-fontsettings.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-bookdown.js"></script>
<script src="libs/gitbook-2.6.7/js/jquery.highlight.js"></script>
<script src="libs/gitbook-2.6.7/js/plugin-clipboard.js"></script>
<script>
gitbook.require(["gitbook"], function(gitbook) {
gitbook.start({
"sharing": {
"github": false,
"facebook": true,
"twitter": true,
"linkedin": false,
"weibo": false,
"instapaper": false,
"vk": false,
"whatsapp": false,
"all": ["facebook", "twitter", "linkedin", "weibo", "instapaper"]
},
"fontsettings": {
"theme": "white",
"family": "sans",
"size": 2
},
"edit": {
"link": "https://github.com/tpcovino/lres_546_bookdown/edit/main/09_snowmelt_models.Rmd",
"text": "Edit"
},
"history": {
"link": null,
"text": null
},
"view": {
"link": "https://github.com/tpcovino/lres_546_bookdown/blob/main/09_snowmelt_models.Rmd",
"text": null
},
"download": null,
"search": {
"engine": "fuse",
"options": null
},
"toc": {
"collapse": "subsection"
}
});
});
</script>

<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    var src = "true";
    if (src === "" || src === "true") src = "https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.9/latest.js?config=TeX-MML-AM_CHTML";
    if (location.protocol !== "file:")
      if (/^https?:/.test(src))
        src = src.replace(/^https?:/, '');
    script.src = src;
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>
</body>

</html>
